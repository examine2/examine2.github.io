<!DOCTYPE html>
<html lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.2">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/32X32.ico?v=7.4.2">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/16X16.ico?v=7.4.2">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.2" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.2">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.4.2',
    exturl: false,
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":null},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="&amp;emsp;">
<meta name="keywords" content="CTF,Misc,Forensics">
<meta property="og:type" content="article">
<meta property="og:title" content="内存取证（一）">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2021&#x2F;02&#x2F;07&#x2F;Memory%20Forensics&#x2F;index.html">
<meta property="og:site_name" content="examine2&#39;s Blog">
<meta property="og:description" content="&amp;emsp;">
<meta property="og:locale" content="en">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201107192216598.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201107200545410.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201107201444155.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201107204142512.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201107204512406.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201118230101137.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201107211054608.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201108220659999.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201108175114162.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201108220746182.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201108220842086.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201108184552155.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201108214338060.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201109000235252.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201109092621099.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201109005213969.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201109102709610.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201109005213969.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201109155210643.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201109164555987.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201109164744141.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201109164829842.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201109165154324.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201109165314812.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201121002023313.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201109185249479.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201109193707564.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201109200732946.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201108084408153.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201108084408153.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201108092153493.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201108092424817.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201108092638639.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201108103253831.png">
<meta property="og:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201108103622406.png">
<meta property="og:updated_time" content="2021-03-05T06:56:15.136Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;examine-typora-picbed.oss-cn-beijing.aliyuncs.com&#x2F;img&#x2F;image-20201107192216598.png">

<link rel="canonical" href="http://yoursite.com/2021/02/07/Memory%20Forensics/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>内存取证（一） | examine2's Blog</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>
		<a href="https://github.com/examine2" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">examine2's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-首页">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-关于">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-标签">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-分类">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-归档">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/02/07/Memory%20Forensics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/none.ico">
      <meta itemprop="name" content="examine">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="examine2's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          内存取证（一）
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-07 14:25:33" itemprop="dateCreated datePublished" datetime="2021-02-07T14:25:33+08:00">2021-02-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-03-05 14:56:15" itemprop="dateModified" datetime="2021-03-05T14:56:15+08:00">2021-03-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CTF/" itemprop="url" rel="index">
                    <span itemprop="name">CTF</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2021/02/07/Memory%20Forensics/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/02/07/Memory%20Forensics/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>19k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>32 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>&emsp;</p>
<a id="more"></a>

<blockquote>
<p>原创文章，未经许可严禁转载</p>
<p>Author：ex@m1ne2</p>
</blockquote>
<h1 id="Memory-Forensics"><a href="#Memory-Forensics" class="headerlink" title="Memory Forensics"></a>Memory Forensics</h1><p>在计算机或者一些智能设备运行时，可以直接将<strong>物理内存中的临时数据</strong>给保存下来、导出成文件，然后就获得了内存的数据文件</p>
<blockquote>
<p>实际上，VMware虚拟机的「<strong>挂起</strong>」功能正是依靠内存文件实现的</p>
<p>虚拟机文件中，比较重要的文件有：</p>
<ul>
<li><p><strong><code>.vmdk</code></strong></p>
<p><code>.vmdk</code> 是虚拟机磁盘文件(Virtual Machine Disk)，存储着虚拟机中硬盘驱动器的内容</p>
<p>当启动虚拟机时，VMware将会导入 <code>.vmdk</code> 文件，实现虚拟机的启动；而我们所谓的「虚拟机快照」其实就是是将 <code>.vmdk</code> 文件进行备份并重命名（例如，将 <code>Ubuntu 64 位-000001.vmkd</code> 备份为 <code>Ubuntu 64 位-000001-s001.vmdk</code>）</p>
<p>当需要恢复虚拟机到之前的某个状态时，需要导入了之前备份的 <code>.vmdk</code> 文件，并且还需要其它文件（例如 <code>.vmsn</code>）的协助</p>
</li>
<li><p><strong><code>.vmem</code></strong></p>
<p><code>.vmem</code> 是虚拟机内存文件(Virtual Machine Memory)，它表示虚拟机运行时的主存信息</p>
<p>这个文件只有在虚拟机运行时存在，虚拟机关闭后将被清除（或者虚拟机意外崩溃，<code>.vmem</code> 文件将会保留）</p>
<p>在VMware的挂起状态下，视为虚拟机仍在运行，<code>.vmem</code> 文件仍然存在</p>
</li>
<li><p><strong><code>.vmss</code></strong></p>
<p><code>.vmss</code> 是虚拟机快照状态文件(Virtual Machine Snapshot State)，用于辅助虚拟机的挂起和唤醒</p>
</li>
</ul>
<p>当我们点击虚拟机的<kbd>挂起</kbd>键时，虚拟机会将当前的状态保存为一个 <code>.vmem</code> 和 <code>.vmss</code> 文件；「挂起」采用的是「空间换时间」的策略，当挂起后，虚拟机将不再占用资源，但下一次打开虚拟机时，仍能准确地恢复上一次挂起前的状态，精确到任何文件的状态</p>
</blockquote>
<p>在CTF中，就存在一类题目是在这些内存文件中进行分析和检索，提取出flag —— <strong>内存取证</strong>(Memory Forensics)</p>
<hr>
<h2 id="Memory-File-Type"><a href="#Memory-File-Type" class="headerlink" title="Memory File Type"></a>Memory File Type</h2><p>在CTF中，常见的内存镜像文件格式有 <code>.img</code>、<code>.dmp</code>、<code>.raw</code> 和 <code>.vmem</code> 等</p>
<ul>
<li><p><code>.vmem</code></p>
<p>虚拟机软件VMware备份主存信息的文件</p>
<blockquote>
<p>注意VMware运行时存在的 <code>.vmem</code> 与CTF题中常见的 <code>.vmem</code> 有所区别，能够作为题目的 <code>.vmem</code> 都是使用特定的工具导出的</p>
</blockquote>
</li>
<li><p><code>.img</code></p>
<p>压缩整个软盘或整个光盘的一种文件压缩格式</p>
<p><code>.img</code> 可以视为是 <code>.iso</code> 文件的超集，因为 <code>.iso</code> 只能压缩使用ISO9660和UDF这两种文件系统的存储媒介（也就是只能压缩CD或DVD），因此 <code>.img</code> 诞生，它在 <code>.iso</code> 格式的基础上增加了对使用其它文件系统的存储媒介压缩的能力</p>
<p><code>.img</code> 向后兼容 <code>.iso</code></p>
</li>
<li><p><code>.dmp</code></p>
<p>中文名为“转储文件”，是导出(Dump)的文件格式，通常是软件出现问题时手动生成或程序自动生成的</p>
<p>更多介绍见下面<strong>memdump</strong>插件的介绍</p>
</li>
<li><p><code>.raw</code></p>
<p>同样是导出文件，工具DumpIt能够轻松地将一个系统的完整内存进行镜像保存，保存后的文件格式就是 <code>.raw</code></p>
</li>
</ul>
<p>注意，对 <code>.raw</code>、<code>.vmem</code> 等文件使用<strong>file</strong>命令，显示的都是 <strong><code>data</code></strong>！因此有时候在CTF中拿到一个体积较大、但没有后缀名的文件，并且<strong>file</strong>的执行结果是 <code>data</code>，那么可以尝试直接用下面提到的volatility检测</p>
<hr>
<p><strong>内存取证</strong>类题目涉及到非常多的知识点，如果采用自顶向下或自底向上的学习方法，耗时太久得不偿失，所以打算基于遇到过的CTF内存取证类题目，结合介绍工具的使用，来逐渐完善对这类题目的了解和认识</p>
<hr>
<h2 id="Volatility"><a href="#Volatility" class="headerlink" title="Volatility"></a>Volatility</h2><p><strong>Volatility</strong>是一款基于Python开发、开源的内存分析框架，目前在Kali系统中自带；这款框架支持Windows、Linux、Mac OSX甚至Android手机使用的ARM处理器的取证</p>
<blockquote>
<p>虽然Volatility支持不同操作系统，但是这篇文章主要介绍Windows系统</p>
</blockquote>
<p>目前Volatility的最新版本为2.6，其下载方式可以通过：</p>
<ul>
<li><p>官网：<a href="https://www.volatilityfoundation.org/releases" target="_blank" rel="noopener">https://www.volatilityfoundation.org/releases</a></p>
</li>
<li><p>Github：<a href="https://github.com/volatilityfoundation/volatility" target="_blank" rel="noopener">https://github.com/volatilityfoundation/volatility</a></p>
</li>
<li><p>命令行安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install volatility</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<p>具体安装的方式可以参考网上的文章，例如：<a href="https://blog.csdn.net/fly_hps/article/details/79961707" target="_blank" rel="noopener">https://blog.csdn.net/fly_hps/article/details/79961707</a></p>
</blockquote>
<p>安装完成后，我们可以键入 <code>volatility -h</code> 来查看Volatility的用法：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201107192216598.png" alt="image-20201107192216598" style="zoom:67%;" />

<hr>
<p>我们知道，一个内存镜像实际上就相当于一台静止的计算机，其所涉及到的知识点是非常广的</p>
<p>Volatility采用「<strong>插件(Plugin)</strong>」的方式，将一个个产生具体作用的工具进行封装，以便针对不同功能进行分别调用</p>
<p>我们可以在 <code>-h</code> 参数中看到Volatility支持的所有插件列表：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201107200545410.png" alt="image-20201107200545410" style="zoom:67%;" />

<p>或者通过 <code>--info</code> 参数打印出所有已经注册的对象（包含插件）</p>
<p>&emsp;</p>
<p>在安装后，我们可以直接在安装目录下查看已有的Plugin；例如，安装在WSL下的位置为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\examine\AppData\Local\Packages\CanonicalGroupLimited.UbuntuonWindows_79rhkp1fndgsc\LocalState\rootfs\usr\lib\python2.7\dist-packages\volatility</span><br></pre></td></tr></table></figure>

<p>在其 <code>plugins</code> 目录下，可以看到每个Plugin以 <code>.py</code> 的形式存在，并且为了更快地被调用，同时以编译后的 <code>.pyc</code> 形式存在</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201107201444155.png" alt="image-20201107201444155" style="zoom:67%;" />

<hr>
<h3 id="Parameters"><a href="#Parameters" class="headerlink" title="[Parameters]"></a>[Parameters]</h3><ul>
<li><p><code>-f</code> &amp; <code>--filename</code></p>
<p>输入待检查的内存镜像文件</p>
</li>
<li><p><code>-h</code> &amp; <code>--help</code></p>
<p>查看Volatility的基本使用方法</p>
</li>
<li><p><code>--profile</code></p>
<p>指定配置文件（具体见后面<strong>imageinfo</strong>的介绍）</p>
</li>
</ul>
<hr>
<h3 id="imageinfo"><a href="#imageinfo" class="headerlink" title="imageinfo"></a>imageinfo</h3><ul>
<li>查看镜像文件的镜像信息(Image Infomation)</li>
</ul>
<p>在不同版本的操作系统中，内核数据结构成员以及偏移量都可能不同，因此在使用Volatility时，需要通过 <code>--profile</code> 参数指定一个<strong>profile</strong>值，以便加载对应的解析器；只有解析器与内存镜像文件吻合，之后的分析提取才能正常进行</p>
<p><strong>profile</strong>(配置文件)在不同的操作系统、不同的版本中都具有一个唯一的名称，通常由：①操作系统名称；②版本；③服务包；④系统结构；等信息组成</p>
<blockquote>
<p>例如，<code>Win7SP1x64</code> 表示的是64位的Windows 7 SP1系统配置文件</p>
</blockquote>
<p>我们同样可以通过 <code>--info</code> 参数来查看Volatility支持的<strong>profile</strong>值：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201107204142512.png" alt="image-20201107204142512" style="zoom:67%;" />

<p>对于一个陌生的内存镜像文件，首先应该使用<strong>imageinfo</strong>插件提取出内存文件的一些基本信息，例如：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201107204512406.png" alt="image-20201107204512406" style="zoom:67%;" />

<p>上图中，<strong>imageinfo</strong>的 <code>Suggested Profile(s)</code> 字段显示出 <code>Temp.vmem</code> 可能的<strong>profile</strong>值</p>
<blockquote>
<p><strong>imageinfo</strong>插件是基于另一个插件kdbgscan来猜测<strong>profile</strong>值的，而kdbgscan则是通过查找分析「内核调试器数据库(<code>_KDDEBUGGER_DATA_64</code>)」的特征值来进行<strong>profile</strong>的猜测</p>
</blockquote>
<p>执行<strong>imageinfo</strong>通常会有多个结果，通常第一个就是正确的，随后在后面的插件使用中，需要指定Volatility的 <code>--profile</code> 参数；而当不指定时，从 <code>-h</code> 参数中可以看到 <code>--profile</code> 的默认值是 <code>WinXPSP2x86</code>，如果与实际的内存镜像文件不匹配，会导致错误</p>
<p>倘若指定的 <code>--profile</code> 参数错误，那么会提示 <strong><code>No suitable address space mapping found</code></strong></p>
<hr>
<blockquote>
<p>本部分学习参考：</p>
<ul>
<li><a href="https://blog.csdn.net/fly_hps/article/details/79961707" target="_blank" rel="noopener">利用Volatility进行Windows内存取证分析(一)：初体验</a></li>
</ul>
</blockquote>
<h4 id="伪装"><a href="#伪装" class="headerlink" title="伪装"></a>伪装</h4><p>不知道你有没有留意，Dump出来的内存镜像文件在 <code>file</code> 命令下的结果都是 <code>data</code>；也就是说，内存镜像文件没有文件头</p>
<p>这也就是导致了有时候我们单纯通过一些常见的文件后缀（如 <code>.vmem</code>、<code>.raw</code> 等）进行判断是内存镜像文件，但拿到一个无后缀的文件，检测结果还是 <code>data</code>，那就很有可能被误导</p>
<p>更有甚者，我们可以为 <code>data</code> 的内存镜像文件添加上一些文件头，伪装成其它文件；例如，添加上 <code>.png</code> 的文件头：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">89504e470d0a1a0a0000000d494844520000003c0000003c08060000003afcd972</span><br></pre></td></tr></table></figure>

<p>举例，2016 Google CTF 内存取证题 <a href="https://www.rootusers.com/google-ctf-2016-forensic-for1-write-up/" target="_blank" rel="noopener">For1</a></p>
<p>这道题目在内存镜像文件前面添加了0x238 Bytes的 <code>.elf</code> 文件头：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201118230101137.png" alt="image-20201118230101137" style="zoom:67%;" />

<p>使得 <code>flie</code> 检测的结果为 <code>ELF</code>，但实际运行该 <code>.elf</code> 会报错，无法运行</p>
<hr>
<p>通常为了不被这种伪装迷惑，可以从以下角度入手：</p>
<ol>
<li><p>文件体积较大</p>
</li>
<li><p><code>binwalk</code> 输出信息，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DECIMAL       HEXADECIMAL     DESCRIPTION</span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">150720        0x24CC0         Microsoft executable, portable (PE)</span><br><span class="line">656418        0xA0422         Copyright string: &quot;Copyright 1985-1998,Phoenix Technologies Ltd.All rights reserved.&quot;</span><br><span class="line">827522        0xCA082         Copyright string: &quot;Copyright (C) 2003-2014  VMware, Inc.&quot;</span><br><span class="line">827561        0xCA0A9         Copyright string: &quot;Copyright (C) 1997-2000  Intel Corporation&quot;</span><br><span class="line">942684        0xE625C         ISO 9660 Boot Record,</span><br></pre></td></tr></table></figure>

</li>
</ol>
<hr>
<h3 id="pslist"><a href="#pslist" class="headerlink" title="pslist"></a>pslist</h3><ul>
<li>罗列进程(List Process)</li>
</ul>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201107211054608.png" alt="image-20201107211054608" style="zoom: 67%;" />

<p>内存镜像文件中保存着计算机某一时刻的快照，因而能够记录下当时计算机内存中运行的所有进程，使用<strong>pslist</strong>插件能够罗列出所有的进程</p>
<p>在CTF中，罗列出来的大部分是系统进程，可以视为干扰项；而有时候Hint会出现在个别进程中，需要根据<strong>pslist</strong>的返回结果仔细检查某些进程</p>
<p><strong>pslist</strong>返回结果中，各个字段的含义是：</p>
<ul>
<li><p><code>Offset(V)</code> —— 各个进程在内存中的虚拟偏移量(Virtual Offset)</p>
</li>
<li><p><code>Name</code> —— 进程名称</p>
</li>
<li><p><code>PID</code> —— 进程编号(Process Identifier)</p>
</li>
<li><p><code>PPID</code> —— 父进程编号(Parent Process Identifier)</p>
</li>
<li><p><code>Thds</code> —— 线程数量(number of Threads)</p>
</li>
<li><p><code>Hnds</code> —— 句柄数量(number of Handles)</p>
<blockquote>
<p><strong>句柄(Handle)</strong>这一概念应当与<strong>进程(Process)</strong>关联学习，可以参考：</p>
<ul>
<li><a href="https://www.cnblogs.com/klb561/p/10555571.html" target="_blank" rel="noopener">https://www.cnblogs.com/klb561/p/10555571.html</a></li>
<li><a href="https://stackoverflow.com/questions/4120849/whats-the-differences-between-a-process-id-and-a-process-handle" target="_blank" rel="noopener">https://stackoverflow.com/questions/4120849/whats-the-differences-between-a-process-id-and-a-process-handle</a></li>
</ul>
</blockquote>
</li>
<li><p><code>Sess</code> —— 运行进程的各个会话(Session)</p>
</li>
<li><p><code>Wow64</code> —— 是否是运行在64位系统上的32位进程(Windows 32-bit on Windows 64-bit)</p>
</li>
<li><p><code>Start</code> —— 进程开始运行的时间</p>
</li>
<li><p><code>Exit</code> —— 进程结束的时间；如果该字段存在值，表示当前进程已经结束了</p>
</li>
</ul>
<hr>
<h3 id="pstree"><a href="#pstree" class="headerlink" title="pstree"></a>pstree</h3><p><strong>pstree</strong>与<strong>pslist</strong>基本相同，只是在 <code>Name</code> 的显示方式上，<strong>pstree</strong>采用「树」的结构，将进程间的「父子关系(Child-Parent Relationship)」表示出来，更为清晰</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201108220659999.png" alt="image-20201108220659999" style="zoom:67%;" />

<p>有时候，我们不仅可以通过进程名称来发觉异常，还可以通过「子进程」来发现一些不妥的关系</p>
<blockquote>
<p>例如，<code>explorer.exe</code> 表示浏览器，而 <code>svchost.exe</code> 是标准的动态链接库主机处理服务；在系统服务进程中，<code>svchost.exe</code> 很特殊，它往往有很多个，而这一点很容易被黑客利用，将病毒伪装成 <code>svchost.exe</code></p>
<p><code>explorer.exe</code> 是绝对不应该生成 <code>svchost.exe</code> 的任何实例的，当从<strong>pstree</strong>中看到这种父子关系时，就可以察觉出异常</p>
<p>又例如：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201108175114162.png" alt="image-20201108175114162" style="zoom:67%;" />

<p>你觉得浏览器 <code>explorer.exe</code> 为什么会启动 <code>cmd.exe</code> ？</p>
</blockquote>
<hr>
<h3 id="psscan"><a href="#psscan" class="headerlink" title="psscan"></a>psscan</h3><p>无论是pslist还是pstree，两者都是通过遍历 <code>PsActiveProcessHead</code> 指向的双向链表来列举出系统进程的，而有时候，如果将某个进程从双向链表中<strong>解链</strong>，那么两者都将检测不到这个进程</p>
<p>通过这种方式使进程不出现在列表中，看上去是一种可靠的隐藏方法，并且这种修改不会影响其性能</p>
<blockquote>
<p>「解链」操作可以通过类似&quot;直接内核对象操纵(Direct Kernel Object Manipulation，简称DKOM)&quot;的技术实现</p>
</blockquote>
<p>而插件<strong>psscan</strong>同样是罗列进程，但它采用的方法和pslist、pstree不同，它使用池标签扫描 <code>_POOL_HEADER</code> 来枚举进程，可以找到先前已终止的进程或解链的进程，进而找出可能存在的隐藏的进程</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201108220746182.png" alt="image-20201108220746182" style="zoom:67%;" />

<p>可以看到，<strong>psscan</strong>输出的内容与pslist稍有些不同：</p>
<ul>
<li><p><code>Offset(P)</code></p>
<p><strong>psscan</strong>直接输出了进程的物理偏移量(Physics Offset)而不是虚拟偏移量(Virtual Offset)，这是因为<strong>psscan</strong>遍历了内存镜像的“原始”字节，并不关心虚拟到物理的内存地址转换</p>
</li>
<li><p><code>PDB</code></p>
<p>也正是因为<strong>psscan</strong>输出的是物理偏移量，所以输出中也出现了<strong>页目录库（Page Directory Base，简称PDB）</strong></p>
<p>PDB包含虚拟地址到物理地址的转换中所使用的索引</p>
</li>
</ul>
<p>在「检索隐藏进程」上，<strong>psscan</strong>要优于pslist和pstree，虽然<strong>psscan</strong>花费的时间相对较多；而<strong>psscan</strong>也是能够呈现进程间的父子关系的，但是需要通过 <code>--output</code> 和 <code>--output-file</code> 参数导出为 <code>.dot</code> 文件：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201108220842086.png" alt="image-20201108220842086" style="zoom:67%;" />

<blockquote>
<p><strong>psscan</strong>导出的文件类型只支持 <code>.dot</code>、<code>.greptext</code>、<code>.html</code>、<code>.json</code>、<code>.sqlite</code>、<code>.txt</code>、<code>.xlsx</code></p>
</blockquote>
<p>在Windows操作系统，可以使用Graphviz自带的gvedit.exe打开 <code>.dot</code> 文件进行查看：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201108184552155.png" alt="image-20201108184552155" style="zoom:67%;" />

<p>而Linux操作系统则通过安装xdot来打开 <code>.dot</code> 文件</p>
<hr>
<blockquote>
<p>本部分学习参考：</p>
<ul>
<li><a href="https://resources.infosecinstitute.com/topic/finding-and-enumerating-processes-within-memory-part-1/" target="_blank" rel="noopener">Ways to Find Processes in Memory Using Volatility</a></li>
<li><a href="https://lifars.com/wp-content/uploads/2020/06/Windows-Memory-Forensics-Technical-Guide-Part-2.pdf" target="_blank" rel="noopener">Windows Memory Forensics Ⅱ</a></li>
</ul>
</blockquote>
<hr>
<h3 id="memdump"><a href="#memdump" class="headerlink" title="memdump"></a>memdump</h3><p>前面介绍的pslist、pstree、psscan都是检查镜像文件中的进程，进程以PID唯一标识，当我们察觉到某个进程可能存在问题时，可以通过<strong>memdump</strong>插件将进程单独从内存镜像文件中Dump出来，变为<strong>转储文件(<code>.dmp</code>)</strong></p>
<p>使用方法为：</p>
<ul>
<li><code>-p</code> —— 指定PID</li>
<li><code>--dump-dir=</code> —— 指定导出的目录</li>
</ul>
<p>事实上，在正常的计算机中，也可以根据进程创建 <code>.dmp</code> 转储文件</p>
<p>例如，打开任务管理器，右键点击进程，有<kbd>创建转储文件(C)</kbd>的选项：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201108214338060.png" alt="image-20201108214338060" style="zoom:67%;" />

<blockquote>
<p>使用任务管理器生成转储文件需要遵循一个原则：</p>
<ul>
<li>用32位任务管理器为32位进程生成转储文件；用64位任务管理器为64位进程生成转储文件</li>
</ul>
<p>在64位操作系统上，默认启动的是64位的任务管理器，而32位的任务管理器位于 <code>C:\Windows\SysWOW64\Taskmgr.exe</code></p>
</blockquote>
<p>&emsp;</p>
<p>正常情况下，<code>.dmp</code> 转储文件是在系统崩溃时自动生成的，其将内存中的数据转储在 <code>.dmp</code> 文件中，给有关人员用作排错分析</p>
<p>很多时候测试人员无法复现遇到的崩溃问题，就可以使用计算机上保存的 <code>.dmp</code> 转储文件</p>
<p><code>.dmp</code> 转储文件可以视为是进程某一时刻的快照，可以包含模块、堆、栈等信息，我们可以调试转储文件，但无法像调试程序那样让程序运行起来，不能进行单步执行、设置断点等，但可以查看线程、调用栈、变量等信息</p>
<p>一般情况下，<code>.dmp</code> 转储文件的分析需要专门的工具，例如Dumpchk.exe等，但在CTF中通常不涉及那么深</p>
<hr>
<p>回到进程本身，在CTF中通常通过<strong>pslist</strong>或<strong>psscan</strong>罗列出所有进程后，分析其中可能存在异常的进程；而Volatility拥有一些插件，能够更容易地分析出进程的内容</p>
<hr>
<h3 id="notepad"><a href="#notepad" class="headerlink" title="notepad"></a>notepad</h3><p>在Dump为内存镜像时，可能在运行<strong>记事本(notepad.exe)</strong>进程，如果通过pslist检查到有 <code>notepad.exe</code>，那么可以通过插件<strong>notepad</strong>检查记事本的内容</p>
<blockquote>
<p><font color='red'>Mark，不同进程的 <code>.dmp</code> 文件分析方式不同，<strong>notepad</strong>能够直接查看notepad.exe进程的内容，本质上是对notepad.exe对应的 <code>.dmp</code> 转储文件进行了解析；如果后续需要学习如何分析 <code>.dmp</code> 文件，可以直接从Volatility的 <code>notepad.py</code> 下手</font></p>
</blockquote>
<h4 id="Example-1"><a href="#Example-1" class="headerlink" title="* [Example_1]"></a>* [Example_1]</h4><p>我们以一道例题来查看<strong>notepad</strong>的用法（源自「内存取证三项」第一项）：</p>
<blockquote>
<p>链接：<a href="https://pan.baidu.com/s/1XJrer01wxTFq7MjRaFfUiA" target="_blank" rel="noopener">https://pan.baidu.com/s/1XJrer01wxTFq7MjRaFfUiA</a><br>提取码：cbc6<br>题目描述：【第一项】小黑在桌面上写着什么，写得是啥？据说是flag</p>
</blockquote>
<p>前面通过imageinfo获取profile，然后执行pslist，查看到有 <code>notepad.exe</code> 在运行；结合题目描述，很可能当时在打开记事本写东西，因此使用<strong>notepad</strong>查看内容：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201109000235252.png" alt="image-20201109000235252" style="zoom:67%;" />

<p>将其中的Hex转ASCII字符后得到flag：<code>flag{W3lec0me_7o_For3n5ics}</code></p>
<hr>
<p>值得一提的是，<strong>notepad</strong>只能提取ASCII字符，如果记事本的内容为中文，将会得到乱码；目前没有什么解决办法</p>
<hr>
<h3 id="cmdscan"><a href="#cmdscan" class="headerlink" title="cmdscan"></a>cmdscan</h3><p>如果检测到内存镜像有 <code>cmd.exe</code> 的进程，那么可以通过<strong>cmdscan</strong>插件来获取 <code>cmd.exe</code> 的历史执行命令；其本质是查找常量 <code>MaxHistory</code>，然后应用完整性检验，提取内存镜像中的 <code>COMMAND_HISTORY</code> 缓冲区内容</p>
<p>我们可以右键点击Cmd上方，点击<kbd>属性</kbd>后查看其缓冲区：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201109092621099.png" alt="image-20201109092621099" style="zoom:67%;" />

<p>除此之外，也可以直接在注册表中进行修改，位置为：<code>HKEY_CURRENT_USER\Console\HistoryBufferSize</code></p>
<p>Windows系统上缓冲区大小的默认值为50，表示能够保存最近的50条命令；因为有保存，所以能够通过一些方式进行提取</p>
<p>值得一提的是，<strong>cmdscan</strong>是由Michael Ligh从conhost.exe和winsrv.dll文件中逆向分析得到的，这款插件使用的结构是不公开的，你也没法在Volatility中找到相应的 <code>cmdscan.py</code> 文件；<strong>cmdscan</strong>可以视为是集成在Volatility中，因此它不能在其它取证框架（例如WinDBG等）中使用</p>
<p>&emsp;</p>
<h4 id="Example-2"><a href="#Example-2" class="headerlink" title="* [Example_2]"></a>* [Example_2]</h4><p>我们以前面题目来进行<strong>cmdscan</strong>的学习：</p>
<blockquote>
<p>链接：<a href="https://pan.baidu.com/s/1XJrer01wxTFq7MjRaFfUiA" target="_blank" rel="noopener">https://pan.baidu.com/s/1XJrer01wxTFq7MjRaFfUiA</a><br>提取码：cbc6<br>题目描述：【第二项】小黑发送了一个机密文件，里面到底有什么？</p>
</blockquote>
<p>在获取profile后，用<strong>cmdscan</strong>提取Cmd的历史记录：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201109005213969.png" alt="image-20201109005213969" style="zoom:67%;" />

<p>可以看到，<strong>cmdscan</strong>提取出来共有3个程序打开了Cmd，在了解各个字段的意义之前，还有一些扩展知识</p>
<hr>
<h4 id="csrss-exe"><a href="#csrss-exe" class="headerlink" title="csrss.exe"></a><code>csrss.exe</code></h4><p>在早期的Windows版本中，所有代表非GUI活动的应用程序（也就是<strong>控制台应用程序</strong>）如果要在桌面上运行，必须经过系统进程 <code>csrss.exe</code> 来进行协调</p>
<p>此时称 <code>csrss.exe</code> 为<strong>控制台主机</strong></p>
<blockquote>
<p>例如，当<strong>控制台应用程序</strong>需要接收字符时，会在 <code>Kernel32.dll</code> 中调用一个小型的「控制台APIs」让Kernel32产生LPC来调用 <code>csrss.exe</code>；随后 <code>csrss.exe</code> 会检查控制台窗口的输入队列并进行校验，以字符模式的结果架通过Kernel32返回给<strong>控制台应用程序</strong></p>
</blockquote>
<p><code>csrss.exe</code> 的全称为<strong>客户端/服务器运行进程(Client Server Runtime Process)</strong>，我们通常可以在任务管理器中找到它：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201109102709610.png" alt="image-20201109102709610" style="zoom:67%;" />

<p>而 <code>csrss.exe</code> 可以有很多个，由所有 <code>csrss.exe</code> 构成<strong>客户端/服务器运行子系统(Client Server Runtime SubSystem)</strong></p>
<blockquote>
<p>注意这两个概念的区分</p>
</blockquote>
<p>但是 <code>csrss.exe</code> 是始终运行在本地账户权限下的，并且所有命令行进程都是使用一个Session唯一的 <code>csrss.exe</code>，因此某些情况下，黑客可以通过开发恶意软件利用 <code>csrss.exe</code> 获取到更多权限。这种攻击模式被称为Shatter Attack</p>
<hr>
<h4 id="conhost-exe"><a href="#conhost-exe" class="headerlink" title="conhost.exe"></a><code>conhost.exe</code></h4><p>到了Windows 7，将原本的 <code>csrss.exe</code> 用 <code>conhost.exe</code> (Console Host Process)来替代</p>
<p>所有的控制台应用程序都被放到一个新的上下文进程 <code>conhost.exe</code> 中执行，由于这时的控制台主机是 <code>conhost.exe</code>，其与控制台应用程序运行在相同安全级的上下文环境中，因此任何应用程序企图利用消息请求来自动提权都不会成功</p>
<p>更换为 <code>conhost.exe</code> 后，控制台应用程序不再发出LPC消息去请求 <code>csrss.exe</code>，而是去请求 <code>conhost.exe</code></p>
<hr>
<p><code>csrss.exe</code> 和 <code>conhost.exe</code> 存在的必要是因为<strong>控制台应用程序</strong>没有自身代码来显示UI，因此需要「宿主进程」来完成窗口的显示、消息处理等</p>
<hr>
<h4 id="cmdscan-1"><a href="#cmdscan-1" class="headerlink" title="cmdscan"></a>cmdscan</h4><p>回到我们<strong>cmdscan</strong>的提取结果：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201109005213969.png" alt="image-20201109005213969" style="zoom:67%;" />

<p>我们分析第1个程序的Cmd情况，分析部分字段：</p>
<ul>
<li><p><code>CommandProcess</code> —— Cmd主机进程的名称（<code>csrss.exe</code> 或 <code>conhost.exe</code>）</p>
</li>
<li><p><code>Application</code> —— 使用Cmd的应用程序名称</p>
</li>
<li><p><code>CommandCount</code> —— 从命令的历史记录缓冲区提取的命令数</p>
</li>
<li><p><code>LastAdded</code>、<code>LastDisplayed</code> —— 最后添加的命令索引、最后显示的命令索引</p>
</li>
<li><p><code>FirstCommand</code>、<code>CommandCountMax</code> —— 首条命令的索引、最大命令记录数量（通常为50）</p>
</li>
<li><p><code>ProcessHandle</code> —— 应用进程句柄</p>
</li>
<li><p><code>Cmd</code></p>
<p>最后根据 <code>CommandCount</code> 依次罗列出执行过的命令</p>
</li>
</ul>
<p>分析第1个程序的Cmd情况，可以看到 <code>Application</code> 是 <code>cmd.exe</code>，因此是用户直接打开Cmd的；然后依次执行了：① <code>ipconfig</code> 查看网络状况；② <code>cd</code> 切换目录；③ 启动 <code>nc</code>，向192.168.57.14的2333端口发送了一个文件</p>
<p>于是我们在<strong>cmdscan</strong>这里发现了异常</p>
<p>我们再来分析除 <code>cmd.exe</code> 外其它两个打开Cmd的应用程序：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201109155210643.png" alt="image-20201109155210643" style="zoom:67%;" />

<p><code>nc.exe</code> 是由上一条的 <code>cmd.exe</code> 打开的，而 <code>DumpIt.exe</code> 则是一款将计算机内存镜像保存的工具，用于生成 <code>.raw</code> 文件</p>
<p>因此我们可以猜测，出题人进行的操作是：①手动打开Cmd，并通过 <code>nc</code> 发送了一个 <code>.zip</code> 文件；②使用 <code>DumpIt.exe</code> 将当前的内存镜像保存下来，作为CTF题目</p>
<p>此外上图还需要注意两点：</p>
<ol>
<li><p><code>LastAdded</code> 和 <code>LastDisplayed</code> 处的 <code>-1</code></p>
<p><code>-1</code> 是无效的索引，因此这表明「Cmd被打开但是没有执行任何命令」</p>
</li>
<li><p><code>Cmd</code> 处的 <code>.4148</code></p>
<p>「提取Cmd历史命令」实际上是通过暴力检索命令池，因此很难确定检索得到的结果是否是一条有效的命令；<strong>cmdscan</strong>采用推荐的命令长度（<code>_COMMAND.CmdLength</code>）的方式来确定一条命令是否有效；基于此，有时候<strong>cmdscan</strong>的结果可能是成功恢复的历史命令，也有可能是无意义的字符串</p>
</li>
</ol>
<hr>
<h3 id="consoles"><a href="#consoles" class="headerlink" title="consoles"></a>consoles</h3><p>Stevens和Casey的研究使得人们知道可以从 <code>csrss.exe</code> 和 <code>conhost.exe</code> 中提取到许多有用的信息，插件cmdscan只能够显示历史出现的命令，其它信息都无法恢复，而<strong>consoles</strong>插件则能够将命令的输出结果也恢复</p>
<p>原理是cmdscan只扫描 <code>COMMAND_HISTORY</code>，并且只打印输入过的命令；而<strong>consoles</strong>则是扫描 <code>COMMAND_INFORMATION</code>，除了打印输入的命令外，还将收集整个屏幕缓冲区，将命令对应的输出结果也进行打印</p>
<p>我们尝试对前面的 <code>L-12A6C33F43D74-20161114-125252.raw</code> 内存镜像文件使用<strong>consoles</strong>插件，对比cmdscan的显示结果</p>
<p><strong>consoles</strong>首先会输出与cmdscan相似的内容，主要是执行过的历史命令（顺序被打乱了）：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201109164555987.png" alt="image-20201109164555987" style="zoom:67%;" />

<p>随后就按照时间顺序，紧接一行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Screen 0x2d77750 X:80 Y:300</span><br><span class="line">Dump:</span><br></pre></td></tr></table></figure>

<p>后，将所有命令的执行过程打印出来；首先是 <code>cmd.exe</code> 中的内容：</p>
<ol>
<li><p>首先是 <code>ipconfig</code>：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201109164744141.png" alt="image-20201109164744141" style="zoom:67%;" />
</li>
<li><p>然后是 <code>cd</code>，可以看到当前目录的变化：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201109164829842.png" alt="image-20201109164829842" style="zoom:67%;" />
</li>
<li><p>最后是 <code>nc</code>：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201109165154324.png" alt="image-20201109165154324" style="zoom:67%;" />

</li>
</ol>
<p><code>cmd.exe</code> 执行完毕后，紧接着的是 <code>DumpIt.exe</code> 对应的Cmd记录，从这里可以看到出题人的操作：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201109165314812.png" alt="image-20201109165314812" style="zoom:67%;" />

<hr>
<p>在做CTF题目时，如果检测到有 <code>cmd.exe</code> 进程，那么通常先使用<strong>cmdscan</strong>查看大致的命令，然后根据需要，使用<strong>consoles</strong>查看详细的Cmd内容</p>
<p>在例如 <code>dir</code> 等命令时，<strong>consoles</strong>能够得到更多有意义的信息</p>
<hr>
<h3 id="cmdline"><a href="#cmdline" class="headerlink" title="cmdline"></a>cmdline</h3><p>插件<strong>cmdline</strong>与cmdscan作用相似，都是获取Cmd的历史记录，但是似乎<strong>cmdline</strong>更为强大，在有些时候，cmdscan无法提取出信息，但<strong>cmdline</strong>却可以</p>
<p>网络上关于<strong>cmdline</strong>的介绍非常少，几乎都是一句话的介绍 —— &quot;Display process command-line arguments&quot;</p>
<p><strong>cmdline</strong>与cmdscan相比，更侧重于「参数(argument)」这个点上，我们可以认为cmdscan和consoles都是显示在 <code>cmd.exe</code> 上的输入命令记录的，但更多的时候，其它的进程在运行时也会打开类似终端的窗口，快速执行命令后关闭，这类记录只能被<strong>cmdline</strong>检索到</p>
<p>例如：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201121002023313.png" alt="image-20201121002023313" style="zoom:67%;" />

<p>上图就是一些进程的运行情况，例如PID为2724的 <code>NOTEPAD.EXE</code>，它可能是通过双击软件直接打开的，但某种程度上等价于在Cmd窗口中执行 <code>C:\Users\SmartNet\Videos\NOTEPAD.EXE</code> 打开的</p>
<p>我们可以把这种「看似是直接打开软件，实际上是通过类似Cmd执行方式打开」的情况视为在一个假的 <code>cmd.exe</code> 中执行命令，而<strong>cmdline</strong>就是检测这些假的 <code>cmd.exe</code> 的记录的</p>
<blockquote>
<p>上面只是个人理解，暂时不知道对错</p>
</blockquote>
<hr>
<p>综上所述，要从命令行获取有用的信息，依靠的3个插件是：<strong>cmdscan</strong>、<strong>consoles</strong>、<strong>cmdline</strong></p>
<hr>
<h3 id="filescan"><a href="#filescan" class="headerlink" title="filescan"></a>filescan</h3><p>在内存镜像文件中可能保存有许许多多的文件，而<strong>filescan</strong>插件则是用于查找所有可能的文件的，其原理是通过池标签在物理内存中查找 <code>FILE_OBJECT</code>，也正是因为这个原理，<strong>filescan</strong>能够检测到被恶意程序隐藏的文件</p>
<p>注意<strong>filescan</strong>查找的不仅有文件(file)，还可能有目录(directory)等，可以将它们统称为「对象(object)」</p>
<p><strong>filescan</strong>执行后，主要输出下面的字段：</p>
<ol>
<li><p><code>Offset(P)</code> —— 物理偏移量（这个很重要）</p>
</li>
<li><p><code>#Ptr</code>、<code>#Hnd</code> —— 对象的指针数、对象的句柄数</p>
</li>
<li><p><code>Access</code> —— 对象的读(Read)、写(Write)、删除(Delete)权限</p>
<blockquote>
<p>这里的权限不同于常规的Linux <code>rwx</code>，并且不知道大写和小写的区别是什么；暂时没有在网上找到相关资料，待补充</p>
</blockquote>
</li>
<li><p><code>Name</code> —— 对象名称</p>
</li>
</ol>
<p>直接对整个内存镜像文件使用<strong>filescan</strong>可能得到非常多的文件，其中大部分是 <code>.exe</code>、<code>.dll</code> 以及目录；因此<strong>filescan</strong>往往配合<strong>grep</strong>使用，快速筛选出我们需要的文件类型</p>
<blockquote>
<p>例如，在上面的题目中，<strong>cmdscan</strong>显示将一个 <code>.zip</code> 文件通过 <code>nc</code> 发送给了别人，那么本机理应还保存这个 <code>.zip</code> 文件，于是我们可以使用<strong>filescan</strong>将其路径捕获：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201109185249479.png" alt="image-20201109185249479" style="zoom:67%;" />

<p>于是就获得了这个 <code>P@ssW0rd_is_y0ur_bir7hd4y.zip</code> 两个重要的信息：①在内存镜像中的物理偏移量；②路径；</p>
</blockquote>
<hr>
<h3 id="dumpfiles"><a href="#dumpfiles" class="headerlink" title="dumpfiles"></a>dumpfiles</h3><p>可以使用该插件来提取<strong>内存驻留文件(Memory-Resident Files)</strong>，需要为它提供一些必要的参数：</p>
<ul>
<li><p><code>-Q</code></p>
<p>待导出文件的物理地址（可以通过<strong>filescan</strong>获得）</p>
</li>
<li><p><code>-D</code></p>
<p>导出到本地的目录（通常指定为 <code>output/</code>）</p>
</li>
<li><p><code>-S</code></p>
<p>该参数会将导出文件在原内存镜像中的一些信息，以 <code>.json</code> 的形式存在</p>
</li>
</ul>
<p>此外，<strong>dumpfiles</strong>会出于「保持空间对齐(maintain spatial alignment)」的目的，在导出的文件末尾进行<strong>零填充(Zero-Pads)</strong>；有些时候会对导出的文件使用其它工具进行分析，而有些工具会因为末尾填充的 <code>\x00</code> 导致分析错误，因此必要情况下需要手动删除末尾的 <code>\x00</code></p>
<p>在导出后，文件的命名遵循以下规则：</p>
<center>file . PID . [SCMOffset | CAOffset] . [img | dat | vacb]</center>

<p>&emsp;</p>
<ul>
<li><code>PID</code> —— <code>_FILE_OBJECT</code> 对象所处进程的ID</li>
<li><code>img</code> —— 表明该文件导出自一个 <code>ImageSectionObject</code> 对象</li>
<li><code>dat</code> —— 表明该文件导出自一个 <code>DataSectionObject</code> 对象</li>
<li><code>vacb</code> —— 表明该文件导出自一个 <code>ShareCacheMap</code> 对象</li>
</ul>
<p>这里由于不深入了解，因此可以不过多的理会，只需知道导出内存镜像中某个特定文件时，可能同时导出 <code>.img</code>、<code>.dat</code>、<code>.vacb</code> 文件，三者都是相同的（可能零填充的数据量不同）；此外 <code>SCMOffset</code> 和 <code>CAOffset</code> 也暂时不理会</p>
<blockquote>
<p>例如，上面的题目中，通过<strong>cmdscan</strong>获得了 <code>.zip</code> 文件的物理地址 <code>0x0000000002c61318</code>，因此我们可以尝试导出：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201109193707564.png" alt="image-20201109193707564" style="zoom:67%;" />

<p>可以看到 <code>DataSectionObject</code> 和 <code>SharedCacheMap</code> 中都存在 <code>.zip</code> 文件的数据，因此会同时导出 <code>.dat</code> 和 <code>.vacb</code> 文件；我们通过修改后缀名、删除零填充数据就可以恢复 <code>.zip</code></p>
<p>然后根据文件名提示，密码是生日日期，直接爆破数字即可获得压缩包密码 <code>19950101</code>，解而解压得到flag：<code>flag{Thi5_Is_s3cr3t!}</code></p>
<blockquote>
<p>此外，这道题目的另一种做法是：通过<strong>cmdscan</strong>发现通过 <code>nc</code> 传输了 <code>.zip</code> 文件，并且检测到了 <code>nc.exe</code> 进程，所以用<strong>memdump</strong>将整个 <code>nc.exe</code> 进程导出为转储文件；然后用foremost强行分离，可以获得 <code>.zip</code> 文件</p>
</blockquote>
</blockquote>
<hr>
<h3 id="connscan"><a href="#connscan" class="headerlink" title="connscan"></a>connscan</h3><p>扫描内存镜像文件中的所有连接活动，包括活动连接和已终止的连接</p>
<p>以上面的题目为例，我们通过<strong>cmdscan</strong>发现有通过 <code>nc</code> 的连接活动，主要是向IP为 <code>1992.168.57.14:2333</code> 传输了一个 <code>.zip</code> 文件，那么本次活动也应该被<strong>connscan</strong>提取到：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201109200732946.png" alt="image-20201109200732946" style="zoom:67%;" />

<blockquote>
<p>事实上，这道题目的预期做题顺序是：①根据题目中的“发送”猜测有连接活动，通过<strong>connscan</strong>发现远程交互IP以及对应的进程ID为120；②<strong>pslist</strong>查看所有进程，发现PID = 120对应的是 <code>nc.exe</code>，又因为同时存在 <code>cmd.exe</code>，所以很可能是在Cmd中启动了 <code>nc</code>；③<strong>cmdscan</strong>查看历史命令记录</p>
</blockquote>
<p>可惜的是，<strong>connscan</strong>只能够支持x86、x64 Windows XP和Windows 2003 Server使用，其余则会报错，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR   : volatility.debug    : This command does not support the profile Win7SP1x86_23418</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="hashdump"><a href="#hashdump" class="headerlink" title="hashdump"></a>hashdump</h3><p>用户在登陆Windows系统时，需要输入密码，这里就涉及Windows是如何存储用户密码的了</p>
<p>Windows实际上是对用户的密码进行Hash计算后存储，每当用户输入密码时，对当前的输入进行相同的Hash计算，比对后台的哈希值后，确定是否通过</p>
<p>目前来看，Windows作用于用户密码的Hash计算方法主要有2种：</p>
<ol>
<li>LM-Hash</li>
<li>NTLM-Hash</li>
</ol>
<blockquote>
<p>这里只介绍Windows的密码Hash计算方式，Linux相关内容可以参考：<a href="https://blog.csdn.net/lws123253/article/details/89228589" target="_blank" rel="noopener">https://blog.csdn.net/lws123253/article/details/89228589</a></p>
</blockquote>
<hr>
<h4 id="LM-Hash"><a href="#LM-Hash" class="headerlink" title="LM-Hash"></a>LM-Hash</h4><p>LM-Hash的计算规则如下：</p>
<ol>
<li>用户输入的密码最大长度为14个字符，多余的字符会被截断</li>
<li>将用户的密码转换为大写</li>
<li>将用户的密码转换为十六进制字符串，不足14 Bytes则在后面用 <code>\x00</code> 来补全</li>
<li>将14 Bytes分为两个7 Bytes部分，每个部分长56 Bits，再每7 Bits分为8组，每组后面添加一个 <code>0</code>，构成8 Bits；添加后14 Bytes变为16 Bytes</li>
<li>16 Bytes分为两组8 Bytes，分别作为<strong>DES</strong>的密钥，对Magic Number <code>KGS!@#$%</code> 进行加密</li>
<li>将加密后的两个十六进制字符串拼接，得到LM-Hash的计算值</li>
</ol>
<blockquote>
<p>我们用Python3来演示一下计算 <code>qwer1234</code> 的LM-Hash值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">M = <span class="string">b"KGS!@#$%"</span></span><br><span class="line">K1 = <span class="string">b"QWER123"</span></span><br><span class="line">K2 = <span class="string">b"4\x00\x00\x00\x00\x00\x00"</span></span><br><span class="line"></span><br><span class="line">bin_K1 = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> K1:</span><br><span class="line">    bin_K1 += bin(i)[<span class="number">2</span>:].zfill(<span class="number">8</span>)		<span class="comment"># 7个字符，每个字符的ASCII码转8 Bits二进制</span></span><br><span class="line">temp_K1 = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(bin_K1), <span class="number">7</span>):</span><br><span class="line">    temp_K1 += bin_K1[i:i+<span class="number">7</span>] + <span class="string">"0"</span>		<span class="comment"># 在每7 Bits后面插入一个"0"，使得7 Bytes变为8 Bytes</span></span><br><span class="line"></span><br><span class="line">true_K1 = <span class="string">b""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(temp_K1), <span class="number">8</span>):		<span class="comment"># 8 Bytes的01序列转换为对应的ASCII码</span></span><br><span class="line">    true_K1 += bytes(chr(int(temp_K1[i:i+<span class="number">8</span>], <span class="number">2</span>)), encoding=<span class="string">"latin_1"</span>)</span><br><span class="line">print(true_K1)</span><br><span class="line">	<span class="comment"># b'P\xaa\xd0\xaa"\x88\xc8f'</span></span><br></pre></td></tr></table></figure>

<p>用同样的方法得到后半部分作为DES加密的密钥为 <code>b&#39;4\x00\x00\x00\x00\x00\x00\x00&#39;</code>；然后进行加密：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pyDes</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">key1 = pyDes.des(true_K1)</span><br><span class="line">cipher_1 = binascii.hexlify(key1.encrypt(M))</span><br><span class="line">print(cipher_1)</span><br><span class="line">	<span class="comment"># b'1319b0fa23c89f2d'</span></span><br></pre></td></tr></table></figure>

<p>同样得到另一个密钥加密 <code>KGS!@#$%</code> 的结果为 <code>b&#39;ff17365faf1ffe89&#39;</code></p>
<p>因此 <code>qwer1234</code> 最终的LM-Hash值为 <code>1319b0fa23c89f2dff17365faf1ffe89</code></p>
</blockquote>
<p>参考网上的<a href="https://xz.aliyun.com/t/2445" target="_blank" rel="noopener">文章</a>，有找到Python2快速计算LM-Hash的脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> pyDes <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">DesEncrypt</span><span class="params">(str, Des_Key)</span>:</span></span><br><span class="line">    k = des(Des_Key, ECB, pad=<span class="literal">None</span>)</span><br><span class="line">    EncryptStr = k.encrypt(str)</span><br><span class="line">    <span class="keyword">return</span> binascii.b2a_hex(EncryptStr)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Zero_padding</span><span class="params">(str)</span>:</span></span><br><span class="line">    b = []</span><br><span class="line">    l = len(str)</span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> range(l):</span><br><span class="line">        <span class="keyword">if</span> (num &lt; <span class="number">8</span>) <span class="keyword">and</span> n % <span class="number">7</span> == <span class="number">0</span>:</span><br><span class="line">            b.append(str[n:n + <span class="number">7</span>] + <span class="string">'0'</span>)</span><br><span class="line">            num = num + <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">''</span>.join(b)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line"></span><br><span class="line">    test_str = <span class="string">"123456"</span></span><br><span class="line">    <span class="comment"># 用户的密码转换为大写,并转换为16进制字符串</span></span><br><span class="line">    test_str = test_str.upper().encode(<span class="string">'hex'</span>)</span><br><span class="line">    str_len = len(test_str)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 密码不足14字节将会用0来补全</span></span><br><span class="line">    <span class="keyword">if</span> str_len &lt; <span class="number">28</span>:</span><br><span class="line">        test_str = test_str.ljust(<span class="number">28</span>, <span class="string">'0'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 固定长度的密码被分成两个7byte部分</span></span><br><span class="line">    t_1 = test_str[<span class="number">0</span>:len(test_str) / <span class="number">2</span>]</span><br><span class="line">    t_2 = test_str[len(test_str) / <span class="number">2</span>:]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 每部分转换成比特流，并且长度位56bit，长度不足使用0在左边补齐长度</span></span><br><span class="line">    t_1 = bin(int(t_1, <span class="number">16</span>)).lstrip(<span class="string">'0b'</span>).rjust(<span class="number">56</span>, <span class="string">'0'</span>)</span><br><span class="line">    t_2 = bin(int(t_2, <span class="number">16</span>)).lstrip(<span class="string">'0b'</span>).rjust(<span class="number">56</span>, <span class="string">'0'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 再分7bit为一组末尾加0，组成新的编码</span></span><br><span class="line">    t_1 = Zero_padding(t_1)</span><br><span class="line">    t_2 = Zero_padding(t_2)</span><br><span class="line">    <span class="keyword">print</span> t_1</span><br><span class="line">    t_1 = hex(int(t_1, <span class="number">2</span>))</span><br><span class="line">    t_2 = hex(int(t_2, <span class="number">2</span>))</span><br><span class="line">    t_1 = t_1[<span class="number">2</span>:].rstrip(<span class="string">'L'</span>)</span><br><span class="line">    t_2 = t_2[<span class="number">2</span>:].rstrip(<span class="string">'L'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'0'</span> == t_2:</span><br><span class="line">        t_2 = <span class="string">"0000000000000000"</span></span><br><span class="line">    t_1 = binascii.a2b_hex(t_1)</span><br><span class="line">    t_2 = binascii.a2b_hex(t_2)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 上步骤得到的8byte二组，分别作为DES key为"KGS!@#$%"进行加密。</span></span><br><span class="line">    LM_1 = DesEncrypt(<span class="string">"KGS!@#$%"</span>, t_1)</span><br><span class="line">    LM_2 = DesEncrypt(<span class="string">"KGS!@#$%"</span>, t_2)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将二组DES加密后的编码拼接，得到最终LM HASH值。</span></span><br><span class="line">    LM = LM_1 + LM_2</span><br><span class="line">    <span class="keyword">print</span> LM</span><br></pre></td></tr></table></figure>

<p>验证可知与我们的Python3代码效果是相同的</p>
<hr>
<p>LM-Hash由于提出的年份较早，因此弱点十分明显，例如：</p>
<ul>
<li>用户密码会被自动转换为大写，并且通过截断或补齐使得长度强制为14 Bytes</li>
<li>14 Bytes被分为两组7 Bytes，分别对 <code>KGS!@#$%</code> 进行加密</li>
</ul>
<p>14个可打印字符组成的密码共有 $95^{14}$ 种可能，而由于是分为两组单独加密的，被腰斩为 $95^{7}$；又因为不可能有小写字母，因此可能性进一步将为 $69^{7}$</p>
<p>在现代计算机的暴力破解面前，LM-Hash不堪一击</p>
<hr>
<h4 id="NTLM-Hash"><a href="#NTLM-Hash" class="headerlink" title="NTLM-Hash"></a>NTLM-Hash</h4><p>LM-Hash由IBM设计，在洞悉其弱点后，微软提出了自己的哈希算法：NTLM Hash</p>
<p>NTLM Hash主要采用MD4哈希算法，其规则非常简单：</p>
<ol>
<li>每1 Byte的密钥后面附加1 Byte的 <code>\x00</code></li>
<li>对整个字符串进行MD4计算</li>
</ol>
<blockquote>
<p>我们同样用 <code>qwer1234</code> 来演示NTLM Hash的计算过程，实际上非常简短：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">print(hashlib.new(<span class="string">"md4"</span>, <span class="string">b"q\x00w\x00e\x00r\x001\x002\x003\x004\x00"</span>).hexdigest())</span><br><span class="line">	<span class="comment"># 0a640404b5c386ab12092587fe19cd02</span></span><br></pre></td></tr></table></figure>

<p>密码 <code>qwer1234</code> 的NTLM Hash计算结果就是 <code>0a640404b5c386ab12092587fe19cd02</code></p>
</blockquote>
<hr>
<p>NTLM Hash的安全性取决于MD4，而如今MD4已经不再是安全的哈希算法了，面对碰撞有很大破解的可能</p>
<p>因此现在更常用的是NTLMv2 Hash算法，这个算法我们先不谈论</p>
<hr>
<h4 id="Windows-SAM"><a href="#Windows-SAM" class="headerlink" title="Windows SAM"></a>Windows SAM</h4><p>Windows对用户账号的安全管理使用了<strong>安全账号管理器（Security Account Manager，简称SAM）</strong>的机制</p>
<p><strong>SAM</strong>文件其实就是账号-密码的数据库文件，当我们登陆系统时，系统会自动将账号-密码加密，并与Config中的<strong>SAM</strong>自动校对，如果与<strong>SAM</strong>中加密的数据全符合，则成功登陆；否则失败</p>
<p>当登陆Windows系统后，<strong>SAM</strong>是被锁死的，无法复制、移动以及打开；<strong>SAM</strong>的路径通常是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\config\SAM</span><br></pre></td></tr></table></figure>

<p>因此要想获取<strong>SAM</strong>文件中的内容，需要一些特殊的方式；而「Dump为内存镜像」则是其中一种</p>
<p>将当前的操作系统Dump为内存镜像，然后可以通过工具检索到其中的<strong>SAM</strong>（工具例如Volatility等）；由于这时的Windows未登陆，因此访问不会遭到拒绝</p>
<hr>
<p>在CTF中，有时会要求我们提取内存镜像文件中，用户的密码，这时我们可以使用<strong>hashdump</strong>插件</p>
<p><strong>hashdump</strong>插件的功能定义是：「Dump user NTLM and Lanman hashes」，它能够直接提取出内存镜像文件中，存储用户账号-密码的<strong>SAM</strong>文件的内容</p>
<p>例如：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201108084408153.png" alt="image-20201108084408153" style="zoom:67%;" />

<p>上图对 <code>Temp.raw</code> 使用了<strong>hashdump</strong>插件，得到结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">CTF:1000:aad3b435b51404eeaad3b435b51404ee:0a640404b5c386ab12092587fe19cd02:::</span><br></pre></td></tr></table></figure>

<p>在Windows操作系统中，存储用户账号-密码的格式是：</p>
<center>username : RID : LM-Hash : NTLM-Hash : : :</center>

<p>&emsp;</p>
<p>默认的，当Windows用户的密码 ≤ 14个字符时，<strong>SAM</strong>文件中既存放着LM-Hash值、又存放着NTLM-Hash值；当用户密码大于14个字符时，<strong>SAM</strong>中只存放NTLM-Hash</p>
<p>而由于LM-Hash十分不安全，我们可以修改注册表，使得<strong>SAM</strong>文件中只存放NTLM-Hash</p>
<blockquote>
<p>具体操作参考网上文章：在 <code>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa</code> 下，将名为 <code>nolmhash</code> 的DWORD值修改为1（如果没有该字段则新建），然后重启系统即可</p>
<p>实际上，从Windows Server 2008版本开始，系统就自动禁用了LM-Hash</p>
</blockquote>
<p>当LM-Hash为 <code>aad3b435b51404eeaad3b435b51404ee</code> 时，表示的是「空密码」或「未使用LM-Hash」；从我们上面的截图来看，3个用户的LM-Hash都是该值</p>
<p>（而NTLM-Hash为 <code>31d6cfe0d16ae931b73c59d7e0c089c0</code> 也表示「空密码」或「未使用NTLM-Hash」）</p>
<p>&emsp;</p>
<p>Windows Hash中的 <code>RID</code> 是<strong>运行标识(Runtime Identifier)</strong>的缩写，它标识着每个系统用户</p>
<p>对内置的管理员权限账户Adminstrator，<code>RID</code> 为500；而对其它的普通账户，<code>RID</code> 从1000开始、逐渐递增</p>
<hr>
<h4 id="Brute-Hash"><a href="#Brute-Hash" class="headerlink" title="Brute Hash"></a>Brute Hash</h4><p>在提取到用户的Hash后，需要想办法获得Hash计算前的明文；基于Hash的特性，只能通过爆破枚举的方式</p>
<p>我们以前面<strong>hashdump</strong>获得的<strong>SAM</strong>文件内容举例：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201108084408153.png" alt="image-20201108084408153" style="zoom:67%;" />

<p>尝试破解用户CTF的密码 <code>0a640404b5c386ab12092587fe19cd02</code></p>
<ol>
<li><p><strong>在线查询网站</strong></p>
<ul>
<li><p><a href="https://www.cmd5.com/" target="_blank" rel="noopener">https://www.cmd5.com/</a></p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201108092153493.png" alt="image-20201108092153493" style="zoom: 60%;" />
</li>
<li><p><a href="https://www.objectif-securite.ch/ophcrack" target="_blank" rel="noopener">https://www.objectif-securite.ch/ophcrack</a></p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201108092424817.png" alt="image-20201108092424817" style="zoom:67%;" />

<p>（该网站支持同时输入LM-Hash和NTLM-Hash进行攻击，两者用 <code>:</code> 分隔）</p>
</li>
<li><p><a href="https://crackstation.net/" target="_blank" rel="noopener">https://crackstation.net/</a></p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201108092638639.png" alt="image-20201108092638639" style="zoom:67%;" />
</li>
</ul>
</li>
<li><p><strong>JoheTheRipper</strong></p>
<p>下载和使用参考官网：<a href="https://www.openwall.com/john/" target="_blank" rel="noopener">https://www.openwall.com/john/</a></p>
<p>我们首先将<strong>hashdump</strong>提取的Hash导出为文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility -f Temp.raw --profile=Win7SP1x86_23418 hashdump &gt; hash.txt</span><br></pre></td></tr></table></figure>

<p>然后只需为<strong>JoheTheRipper</strong>提供该 <code>hash.txt</code>，并指定破解的格式是 <code>NT</code> 即可</p>
<p>由于<strong>JoheTheRipper</strong>破解 <code>qwer1234</code> 需要的时间有点长，因此可以尝试破解下面的内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">7UNEJz9$:1080:5e011cc31459cf7c25ad3b83fa6627c7:885e980ae56101097d2010bfb540de0c:::</span><br><span class="line">q0Y3a69$:1081:f79f60ca37893010c2265b23734e0dac:58db4601967b755c1a05f447764bae63:::</span><br><span class="line">RhdV8i6$:1083:b5a4c5eb4b9d3ee1aad3b435b51404ee:96880159e785de5314803b1169768900:::</span><br><span class="line">lwq9SL5$:1085:104e1e570ba3356d25ad3b83fa6627c7:226d410164c5e2d14204f05cfea5107b:::</span><br><span class="line">g6mMT0p$:1066:a3218b383ae047331aa818381e4e281b:6142c213414e24fb890baa14ca909953:::</span><br></pre></td></tr></table></figure>

<p>将上面内容保存为 <code>hash.txt</code>，然后使用<strong>JoheTheRipper</strong>进行破解：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201108103253831.png" alt="image-20201108103253831" style="zoom:67%;" />

<p>可以看到，<strong>JohnTheRipper</strong>成功将用户名对应的密码爆破出来</p>
<p>由于指定<strong>JohnTheRipper</strong>破解的方式是 <code>NT</code>，因此其会尝试结合LM-Hash和NTLM-Hash，将密码破解；但同时得注意，由于<strong>JohnTheRipper</strong>采用的是暴力破解的方式，因此有可能会长时间卡在某次解密中，通常结合在线网站和<strong>JohnTheRipper</strong>是比较好的选择</p>
<p>&emsp;</p>
<p><strong>JohnTheRipper</strong>成功将某次的Hash破解后，会将其记录在同目录的 <code>john.pot</code> 文件中：</p>
<img src="https://examine-typora-picbed.oss-cn-beijing.aliyuncs.com/img/image-20201108103622406.png" alt="image-20201108103622406" style="zoom:67%;" />

<p><code>john.pot</code> 记录的格式则是：<code>$ &lt;format&gt; $ &lt;hash&gt; : plaintext</code>；<strong>JohnTheRipper</strong>在破解一个Hash前会在 <code>john.pot</code> 中进行查找，如果是已破解的记录则会跳过破解</p>
</li>
</ol>
<hr>
<h4 id="Example-3"><a href="#Example-3" class="headerlink" title="* [Example_3]"></a>* [Example_3]</h4><p>题目来源：2020 湖湘杯线上赛 Misc_2 [passwd]</p>
<p>题目描述：we need sha1(password)</p>
<blockquote>
<p>链接：<a href="https://pan.baidu.com/s/1DsA9TUtxiwgEUiukZbmkVg" target="_blank" rel="noopener">https://pan.baidu.com/s/1DsA9TUtxiwgEUiukZbmkVg</a><br>提取码：Exam </p>
</blockquote>
<p>&emsp;</p>
<p>解压压缩包，得到 <code>WIN-BU6IJ7FI9RU-20190927-152050.raw</code></p>
<p>由于是需要用户密码，Volatility直接解决即可：</p>
<ol>
<li><strong>imageinfo</strong>查看profile，选择一个 <code>Win7SP1x86_23418</code> 使用</li>
<li><strong>hashdump</strong>查看哈希值，留意到有个CTF用户，哈希值为 <code>0a640404b5c386ab12092587fe19cd02</code></li>
<li>在线网站解哈希得 <code>qwer1234</code>，SHA1计算得到 <code>db25f2fc14cd2d2b1e7af307241f548fb03c312a</code> 即为flag</li>
</ol>
<hr>
<blockquote>
<p>本部分学习参考：</p>
<ul>
<li>我是如何破解你的Windows密码的？ <a href="https://www.cnblogs.com/luverose/p/4267552.html" target="_blank" rel="noopener">https://www.cnblogs.com/luverose/p/4267552.html</a></li>
<li>Windows的口令文件SAM <a href="https://blog.csdn.net/hxxjxw/article/details/89736724" target="_blank" rel="noopener">https://blog.csdn.net/hxxjxw/article/details/89736724</a></li>
<li>Windows用户密码基础知识 <a href="https://blog.51cto.com/qlxmy/1675464" target="_blank" rel="noopener">https://blog.51cto.com/qlxmy/1675464</a></li>
<li><a href="http://www.insecurity.be/blog/2018/01/21/retrieving-ntlm-hashes-and-what-changed-technical-writeup/" target="_blank" rel="noopener">Retrieving NTLM Hashes and what changed in Windows 10</a></li>
<li>LM-Hash &amp;&amp; NTLM-Hash <a href="https://xz.aliyun.com/t/2445" target="_blank" rel="noopener">https://xz.aliyun.com/t/2445</a></li>
</ul>
</blockquote>
<hr>
<p>本部分结束</p>
<blockquote>
<p>参考文献：</p>
<ul>
<li><a href="https://code.google.com/archive/p/volatility/wikis/CommandReference23.wiki" target="_blank" rel="noopener">volatility - CommandReference23.wiki</a></li>
<li><a href="https://www.pdfdrive.com/the-art-of-memory-forensics-detecting-malware-and-threats-in-windows-linux-and-mac-memory-d166596417.html" target="_blank" rel="noopener">PDF: <em>The Art of Memory Forensics Detecting Malware and Threats in Windows Linux and Mac memory</em></a></li>
<li><a href="https://digital-forensics.sans.org/media/volatility-memory-forensics-cheat-sheet.pdf" target="_blank" rel="noopener">Volatility Memory Forensics Cheat Sheet</a></li>
</ul>
</blockquote>
<blockquote>
<p>参考Write-up：</p>
<ul>
<li>内存取证三项<ul>
<li><a href="https://www.cnblogs.com/wrnan/p/12572263.html" target="_blank" rel="noopener">https://www.cnblogs.com/wrnan/p/12572263.html</a></li>
<li><a href="https://www.freebuf.com/news/145262.html" target="_blank" rel="noopener">https://www.freebuf.com/news/145262.html</a></li>
</ul>
</li>
</ul>
</blockquote>
<hr>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/CTF/" rel="tag"># CTF</a>
              <a href="/tags/Misc/" rel="tag"># Misc</a>
              <a href="/tags/Forensics/" rel="tag"># Forensics</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/2021/01/25/CTF%E4%B8%AD%E7%9A%84gif/" rel="next" title="CTF中的Gif">
                  <i class="fa fa-chevron-left"></i> CTF中的Gif
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/2021/02/16/Misc-FileSystem/" rel="prev" title="文件系统 —— Ext2">
                  文件系统 —— Ext2 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="comments"></div>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Memory-Forensics"><span class="nav-number">1.</span> <span class="nav-text">Memory Forensics</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Memory-File-Type"><span class="nav-number">1.1.</span> <span class="nav-text">Memory File Type</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Volatility"><span class="nav-number">1.2.</span> <span class="nav-text">Volatility</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Parameters"><span class="nav-number">1.2.1.</span> <span class="nav-text">[Parameters]</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#imageinfo"><span class="nav-number">1.2.2.</span> <span class="nav-text">imageinfo</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#伪装"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">伪装</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pslist"><span class="nav-number">1.2.3.</span> <span class="nav-text">pslist</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pstree"><span class="nav-number">1.2.4.</span> <span class="nav-text">pstree</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#psscan"><span class="nav-number">1.2.5.</span> <span class="nav-text">psscan</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#memdump"><span class="nav-number">1.2.6.</span> <span class="nav-text">memdump</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#notepad"><span class="nav-number">1.2.7.</span> <span class="nav-text">notepad</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Example-1"><span class="nav-number">1.2.7.1.</span> <span class="nav-text">* [Example_1]</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cmdscan"><span class="nav-number">1.2.8.</span> <span class="nav-text">cmdscan</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Example-2"><span class="nav-number">1.2.8.1.</span> <span class="nav-text">* [Example_2]</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#csrss-exe"><span class="nav-number">1.2.8.2.</span> <span class="nav-text">csrss.exe</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#conhost-exe"><span class="nav-number">1.2.8.3.</span> <span class="nav-text">conhost.exe</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#cmdscan-1"><span class="nav-number">1.2.8.4.</span> <span class="nav-text">cmdscan</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#consoles"><span class="nav-number">1.2.9.</span> <span class="nav-text">consoles</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cmdline"><span class="nav-number">1.2.10.</span> <span class="nav-text">cmdline</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#filescan"><span class="nav-number">1.2.11.</span> <span class="nav-text">filescan</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dumpfiles"><span class="nav-number">1.2.12.</span> <span class="nav-text">dumpfiles</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#connscan"><span class="nav-number">1.2.13.</span> <span class="nav-text">connscan</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hashdump"><span class="nav-number">1.2.14.</span> <span class="nav-text">hashdump</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#LM-Hash"><span class="nav-number">1.2.14.1.</span> <span class="nav-text">LM-Hash</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NTLM-Hash"><span class="nav-number">1.2.14.2.</span> <span class="nav-text">NTLM-Hash</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Windows-SAM"><span class="nav-number">1.2.14.3.</span> <span class="nav-text">Windows SAM</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Brute-Hash"><span class="nav-number">1.2.14.4.</span> <span class="nav-text">Brute Hash</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Example-3"><span class="nav-number">1.2.14.5.</span> <span class="nav-text">* [Example_3]</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="examine"
    src="/images/none.ico">
  <p class="site-author-name" itemprop="name">examine</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">13</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/examine2" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;examine2" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">examine</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="Symbols count total">148k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">4:06</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.4.2
  </div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.2"></script><script src="/js/motion.js?v=7.4.2"></script>
<script src="/js/schemes/pisces.js?v=7.4.2"></script>
<script src="/js/next-boot.js?v=7.4.2"></script>



  


















  

  
      
<script type="text/x-mathjax-config">

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script>
<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script>

    

  

  


<script>
NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js', () => {
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(item => {
    return GUEST.includes(item);
  });
  new Valine({
    el: '#comments',
    verify: true,
    notify: false,
    appId: 'AcnzIAQVbbnuGkhPPb8cjbgW-gzGzoHsz',
    appKey: 'TLbccV8U8hEzCr7sXQrbouRU',
    placeholder: "Welcome to comment.",
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: false,
    lang: 'zh-cn' || 'zh-cn',
    path: location.pathname,
    recordIP: false,
    serverURLs: ''
  });
}, window.Valine);
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>
</html>
