<!DOCTYPE html>
<html lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.2">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/32X32.ico?v=7.4.2">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/16X16.ico?v=7.4.2">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.2" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.2">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.4.2',
    exturl: false,
    sidebar: {"position":"right","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":null},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="&amp;emsp;">
<meta name="keywords" content="CTF,MISC">
<meta property="og:type" content="article">
<meta property="og:title" content="JS代码混淆">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;02&#x2F;12&#x2F;JS%E4%BB%A3%E7%A0%81%E6%B7%B7%E6%B7%86&#x2F;index.html">
<meta property="og:site_name" content="examine2&#39;s Blog">
<meta property="og:description" content="&amp;emsp;">
<meta property="og:locale" content="en">
<meta property="og:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;images&#x2F;js_misunderstand&#x2F;jjencode_by_person.jpg">
<meta property="og:updated_time" content="2020-02-12T14:14:48.289Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http:&#x2F;&#x2F;yoursite.com&#x2F;images&#x2F;js_misunderstand&#x2F;jjencode_by_person.jpg">

<link rel="canonical" href="http://yoursite.com/2020/02/12/JS%E4%BB%A3%E7%A0%81%E6%B7%B7%E6%B7%86/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>JS代码混淆 | examine2's Blog</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>
		<a href="https://github.com/examine2" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">examine2's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-首页">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-关于">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-分类">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-归档">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/12/JS%E4%BB%A3%E7%A0%81%E6%B7%B7%E6%B7%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/none.ico">
      <meta itemprop="name" content="examine">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="examine2's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          JS代码混淆
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-02-12 22:12:51 / Modified: 22:14:48" itemprop="dateCreated datePublished" datetime="2020-02-12T22:12:51+08:00">2020-02-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CTF/" itemprop="url" rel="index">
                    <span itemprop="name">CTF</span>
                  </a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>14k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>24 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>&emsp;</p>
<a id="more"></a>



<h1 id="JS代码混淆"><a href="#JS代码混淆" class="headerlink" title="JS代码混淆"></a>JS代码混淆</h1><p>就像XSS那样，JS代码不经过过滤，直接呈现在浏览器中会被直接执行；因此现在的输入框都对JS代码进行了转码过滤，避免恶意代码的执行</p>
<p>得益于JS代码本身的特性，所有的JS代码能够由最初的几个字符构造而成，这几个字符在《离散数学》中类似<strong>全功能集</strong>的定义</p>
<h2 id="混淆方式"><a href="#混淆方式" class="headerlink" title="混淆方式"></a>混淆方式</h2><h3 id="JSFuck-JSF-ck"><a href="#JSFuck-JSF-ck" class="headerlink" title="JSFuck (JSF*ck)"></a>JSFuck (JSF*ck)</h3><p>日本安全研究人员<code>长谷川阳介</code>制作了名为<code>JSF*ck</code>的编码器，能够将所有JS代码用6个字符（分别是<strong><code>[</code>、<code>]</code>、<code>(</code>、<code>)</code>、<code>!</code>、<code>+</code></strong>）来表示（称之为<strong>用6个字符来混淆JavaScript</strong>）</p>
<ol>
<li><p>构造数字</p>
<p>数字<code>0</code>使用<code>+[]</code>来构造，<code>[]</code>代表空数组、而<code>+</code>是一元加运算符</p>
<p>数字<code>1</code>使用<code>+!![]</code>或<code>+!+[]</code>来构造，其中<code>!![]</code>和<code>!+[]</code>代表布尔值<code>true</code>，前置一元加运算符将真值<code>true</code>转换为<code>1</code></p>
<p>数字<code>2</code>通过真值的相加获得，<code>true+true</code>这一表达式在JS中输出结果为<code>2</code>，而<code>true</code>可以写作<code>!![]</code>或<code>!+[]</code>，所以<code>2</code>可以表示为<code>!![]+!![]</code>或<code>!+[]+!+[]</code></p>
<p>数字<code>3</code>到<code>9</code>方法相同</p>
<p>多位数字通过字符串串接得到，如<code>10</code>，不采用10个<code>true</code>相加，而是先得到字符串<code>&quot;10&quot;</code>；字符串<code>&quot;10&quot;</code>可以表达为两个数组的串接形式<code>[1]+[0]</code>，而将其中的数字替换为JSFuck，就有了<code>[+!+[]]+[+[]]</code>；有了字符串<code>&quot;10&quot;</code>后，在JS中将数字型字符串转换为数值，只需在字符串括在&quot;括号&quot;或&quot;方括号&quot;中，并加上一个<code>+</code>运算符，最终<code>10</code>的JSFuck表达为<code>+([+!+[]]+[+[]])</code></p>
<p><strong>JSFuck的实现得益于JS本身的坑爹性，如：</strong></p>
<ul>
<li><strong>空数组<code>[]</code>前置一元加运算符<code>+</code>变成<code>0</code>，前置一元布尔运算符<code>!</code>变成<code>false</code>；</strong>如<code>!![] = true</code></li>
<li><strong>布尔值<code>true</code>或<code>false</code>前置一元加运算符<code>+</code>能变成对应的<code>1</code>或<code>0</code>；</strong>结合上一条，就有<code>+!![] = 1</code></li>
<li><strong>两个数组相加，得到由元素组成的字符串；</strong>如<code>[1,2]+[3] = &quot;1,23&quot;</code>，你没看错，连分隔符<code>,</code>都在；还可以利用<code>[]+[] = &quot;&quot;</code>得到空字符串，然后用空字符串与布尔值<code>false</code>相加，得到<code>&quot;false&quot;</code></li>
</ul>
<p><strong>你也能理解为什么<code>长谷川阳介</code>先生将它命名为JSFuck而不是JSPraise了</strong></p>
</li>
<li><p>构造字母</p>
<ul>
<li><p>索引构造——常见字符串</p>
<p>像<code>[]+[]+[![]] = &quot;false&quot;</code>能够得到字符串<code>&quot;false&quot;</code>一样，通过下标<code>&quot;false&quot;[0]</code>就能够得到字母<code>&quot;f&quot;</code>，将下标的数字<code>0</code>换成JSFuck，那么<code>&quot;f&quot;</code>就能表示成<code>([]+[]+[![]])[+![]]</code></p>
<p>除了<code>![] = false</code>外，内置的可以利用的字符串还有<code>!![] = true</code>、<code>+[![]] = NaN</code>、<code>[][[]] = undefined</code>，以及<code>+(+!+[]+(!+[]+[])[!+[]+!+[]+!+[]]+[+!+[]]+[+[]]+[+[]]+[+[]]) = Infinity</code></p>
<p>↑ 上面的<code>+(+!+[]+(!+[]+[])[!+[]+!+[]+!+[]]+[+!+[]]+[+[]]+[+[]]+[+[]])</code>是将字符串<code>1e1000</code>转换成数字得到的</p>
<p>将上面的内置显示单词转换为字符串，再用索引提取，能够构造部分字母</p>
<blockquote>
<p>补充</p>
<p>将Boolean类型转换为String，可以通过：</p>
<p>&emsp;<code>[]+[]+false</code>，这是利用<code>[]+[]</code>得到的空字符串，后面的强制转化为字符串</p>
<p>&emsp;<code>[]+false</code>，这是利用JS神奇的强制转换：Array + Boolean = String</p>
</blockquote>
</li>
</ul>
</li>
<li><p>构造函数</p>
<p>通过JSFuck构造字母，得到了字符串<code>&quot;alert(1)&quot;</code>，却发现它并不能像普通的JS代码那样执行——因为这里的<code>&quot;alert(1)&quot;</code>是字符串，而不是<strong>语句</strong></p>
<p>怎样才能变成<code>alert()</code>函数执行呢？</p>
<p>这里需要对JavaScript有比较深入的了解，由于鄙人没时间，所以直接贴出一个答案：<strong><code>[][&quot;filter&quot;][&quot;constructor&quot;](&quot;alert(1)&quot;)()</code></strong>等价于语句<code>alert(1)</code></p>
<p>上面的例子通过三个字符串<code>&quot;filter&quot;</code>、<code>&quot;constructor&quot;</code>和<code>&quot;alert&quot;</code>，将<code>&quot;alert()&quot;</code>从字符串变为执行语句<code>alert()</code></p>
<blockquote>
<p>解释</p>
<p>语句<code>alert(1)</code>等价于<code>Function(&quot;alert(1)&quot;)()</code>，<code>Function</code>是类似其它语言中的<code>eval</code>函数，用于触发执行包含在字符串中的JavaScript代码</p>
<p>而<code>Function</code>是JS中任何<strong>常用函数</strong>的<code>constructor</code>属性，这里的常用函数是指<code>[][&quot;filter&quot;]</code>（即Array.prototype.filter）之类的函数；访问一个空数组的<code>filter</code>属性下的<code>constructor</code>属性，就能够构造出一个<code>Function</code></p>
<p>这也就是为什么语句<code>alert(1)</code>能被表示成<code>[][&quot;filter&quot;][&quot;constructor&quot;](&quot;alert(1)&quot;)()</code>的原因</p>
</blockquote>
</li>
<li><p>构造字母（2）</p>
<ul>
<li><p>索引构造——其它字符串</p>
<p>前面的索引构造是利用内置的显示字符串，如<code>false</code>、<code>true</code>、<code>NaN</code>、<code>undefined</code>、<code>Infinity</code>，除了这几个比较容易得到的字符串之外，还有其它&quot;冷门&quot;的方法</p>
<ul>
<li><p><code>[][&quot;find&quot;] + []</code>会得到字符串<code>&quot;function find() { [native code] }&quot;</code></p>
<p>原理是空数组<code>[]</code>拥有许多<strong>方法</strong>和属性，像访问Python的字典元素那样访问<code>[]</code>的<code>find</code>方法，虽然不能直接执行，但加上一个<code>[]</code>将<code>find</code>强制转换为字符串，就会显示出数组<code>find()</code>方法的一些信息</p>
<p><code>&quot;find&quot;</code>能够从<code>&quot;undefined&quot;</code>中提取，执行<code>[][&quot;find&quot;] + []</code>后就多出了几个字符，如<code>o</code>、<code>{</code>等</p>
</li>
<li><p><code>[][&quot;entries&quot;]() + []</code>会得到字符串<code>&quot;[object Array Iterator]&quot;</code></p>
<p>能够得到新的字符<code>j</code>、<code>A</code>等</p>
</li>
<li><p>......</p>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>以上就是JSFuck的大致实现思路，了解学习一下<strong>混淆</strong>的概念</p>
<p>正是因为<strong>混淆</strong>，JSFuck代码能够被浏览器直接运行，相当于等价的JavaScript代码</p>
<p>如果想深入了解JSFuck的全部实现过程，可以去作者的<a href="https://github.com/aemkei/jsfuck" target="_blank" rel="noopener">Github</a>上看，有十分完整的过程，作者的<a href="https://github.com/aemkei/jsfuck/blob/master/jsfuck.js" target="_blank" rel="noopener">jsfuck.js</a>文件就罗列出了所有字符的表示法</p>
<blockquote>
<blockquote>
<p>【本部分参考】</p>
<p>JSFuck Wiki <a href="https://zh.wikipedia.org/wiki/JSFuck" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/JSFuck</a></p>
<p>JSFuck作者Github <a href="https://github.com/aemkei/jsfuck" target="_blank" rel="noopener">https://github.com/aemkei/jsfuck</a></p>
</blockquote>
</blockquote>
<hr>
<h3 id="aaencode"><a href="#aaencode" class="headerlink" title="aaencode"></a>aaencode</h3><p>aaencode也是JS的一种混淆方式，又称为颜文字编码</p>
<p>经过aaencode混淆的JS代码十分显眼，通篇代码呈现<code>(ﾟДﾟ)(ﾟoﾟ)(ﾟΘﾟ)</code>之类的颜文字，相当可爱</p>
<p>举个例子：</p>
<p><code>o=(˙_˙)  =_=3;</code> 是某一段aaencode得到的代码，表面上看这里只有两个颜文字：<code>o=(˙_˙)</code> 和 <code>=_=3</code>，但其实这里用JS语法定义了三个变量</p>
<p>将颜文字以<code>=</code>为分隔符，拆分开，得到 <code>o  =  (˙_˙)  =  _  =  3;</code></p>
<p>其实就是</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_ = <span class="number">3</span>;</span><br><span class="line">(˙_˙) = _;</span><br><span class="line">o = (˙_˙);</span><br></pre></td></tr></table></figure>

<p>三个赋值语句的<strong>连写</strong>形式</p>
<blockquote>
<p>赋值语句连写在弱类型语言中都可以实现，比如Python</p>
</blockquote>
<p>人眼由于对颜文字的敏感，下意识将 <code>o=(˙_˙)  =_=3;</code> 拆分解读为 <code>o=(˙_˙)</code> 和 <code>=_=3;</code> ；而对浏览器而言，它会尝试以JS的语法去分析它，这时它就以<code>=</code>为分隔符，将 <code>o=(˙_˙)  =_=3;</code> 分析成一条三赋值的JS语句</p>
<p>语句 <code>o=(˙_˙)  =_=3;</code> 让变量 <code>o</code> 、 <code>(˙_˙)</code> 和 <code>_</code> 同时赋值为3；随后就能够在后续代码中用这三个变量替代<code>3</code></p>
<p>类似的代码有 <code>c=(ﾟΘﾟ) =(ﾟｰﾟ)-(ﾟｰﾟ);</code> 暗藏了一个减运算，使得变量 <code>(ﾟΘﾟ)</code> 值为0（前提是变量 <code>(ﾟｰﾟ)</code> 已定义）</p>
<p><strong>混淆JS代码是有代价的，代价之一是冗余</strong>，像上式的 <code>(˙_˙)</code>，其实就是一个用<code>()</code>包起来的 <code>˙_˙</code> 变量，这对括号<code>()</code>事实上是没什么意义的，只是为了构成颜文字额外添加的</p>
<p>冗余的一个体现是<strong>不必要的部分细小的代码</strong>，另一个体现就是<strong>前置条件</strong></p>
<h4 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h4><p>哪怕是空的JS代码，扔到某个<a href="http://utf-8.jp/public/aaencode.html" target="_blank" rel="noopener">aaencode编码器</a>中也会得到很长的一串编码：</p>
<p><code>ﾟωﾟﾉ= /｀ｍ´）ﾉ ~┻━┻   //*´∇｀*/ [&#39;_&#39;]; o=(ﾟｰﾟ)  =_=3; c=(ﾟΘﾟ) =(ﾟｰﾟ)-(ﾟｰﾟ); (ﾟДﾟ) =(ﾟΘﾟ)= (o^_^o)/ (o^_^o);(ﾟДﾟ)={ﾟΘﾟ: &#39;_&#39; ,ﾟωﾟﾉ : ((ﾟωﾟﾉ==3) +&#39;_&#39;) [ﾟΘﾟ] ,ﾟｰﾟﾉ :(ﾟωﾟﾉ+ &#39;_&#39;)[o^_^o -(ﾟΘﾟ)] ,ﾟДﾟﾉ:((ﾟｰﾟ==3) +&#39;_&#39;)[ﾟｰﾟ] }; (ﾟДﾟ) [ﾟΘﾟ] =((ﾟωﾟﾉ==3) +&#39;_&#39;) [c^_^o];(ﾟДﾟ) [&#39;c&#39;] = ((ﾟДﾟ)+&#39;_&#39;) [ (ﾟｰﾟ)+(ﾟｰﾟ)-(ﾟΘﾟ) ];(ﾟДﾟ) [&#39;o&#39;] = ((ﾟДﾟ)+&#39;_&#39;) [ﾟΘﾟ];(ﾟoﾟ)=(ﾟДﾟ) [&#39;c&#39;]+(ﾟДﾟ) [&#39;o&#39;]+(ﾟωﾟﾉ +&#39;_&#39;)[ﾟΘﾟ]+ ((ﾟωﾟﾉ==3) +&#39;_&#39;) [ﾟｰﾟ] + ((ﾟДﾟ) +&#39;_&#39;) [(ﾟｰﾟ)+(ﾟｰﾟ)]+ ((ﾟｰﾟ==3) +&#39;_&#39;) [ﾟΘﾟ]+((ﾟｰﾟ==3) +&#39;_&#39;) [(ﾟｰﾟ) - (ﾟΘﾟ)]+(ﾟДﾟ) [&#39;c&#39;]+((ﾟДﾟ)+&#39;_&#39;) [(ﾟｰﾟ)+(ﾟｰﾟ)]+ (ﾟДﾟ) [&#39;o&#39;]+((ﾟｰﾟ==3) +&#39;_&#39;) [ﾟΘﾟ];(ﾟДﾟ) [&#39;_&#39;] =(o^_^o) [ﾟoﾟ] [ﾟoﾟ];(ﾟεﾟ)=((ﾟｰﾟ==3) +&#39;_&#39;) [ﾟΘﾟ]+ (ﾟДﾟ) .ﾟДﾟﾉ+((ﾟДﾟ)+&#39;_&#39;) [(ﾟｰﾟ) + (ﾟｰﾟ)]+((ﾟｰﾟ==3) +&#39;_&#39;) [o^_^o -ﾟΘﾟ]+((ﾟｰﾟ==3) +&#39;_&#39;) [ﾟΘﾟ]+ (ﾟωﾟﾉ +&#39;_&#39;) [ﾟΘﾟ]; (ﾟｰﾟ)+=(ﾟΘﾟ); (ﾟДﾟ)[ﾟεﾟ]=&#39;\\&#39;; (ﾟДﾟ).ﾟΘﾟﾉ=(ﾟДﾟ+ ﾟｰﾟ)[o^_^o -(ﾟΘﾟ)];(oﾟｰﾟo)=(ﾟωﾟﾉ +&#39;_&#39;)[c^_^o];(ﾟДﾟ) [ﾟoﾟ]=&#39;\&quot;&#39;;(ﾟДﾟ) [&#39;_&#39;] ( (ﾟДﾟ) [&#39;_&#39;] (ﾟεﾟ+(ﾟДﾟ)[ﾟoﾟ]+ (ﾟДﾟ)[ﾟoﾟ]) (ﾟΘﾟ)) (&#39;_&#39;);</code></p>
<p>将JS代码<code>alert(1)</code>经过aaencode混淆，得到：</p>
<p><code>ﾟωﾟﾉ= /｀ｍ´）ﾉ ~┻━┻   //*´∇｀*/ [&#39;_&#39;]; o=(ﾟｰﾟ)  =_=3; c=(ﾟΘﾟ) =(ﾟｰﾟ)-(ﾟｰﾟ); (ﾟДﾟ) =(ﾟΘﾟ)= (o^_^o)/ (o^_^o);(ﾟДﾟ)={ﾟΘﾟ: &#39;_&#39; ,ﾟωﾟﾉ : ((ﾟωﾟﾉ==3) +&#39;_&#39;) [ﾟΘﾟ] ,ﾟｰﾟﾉ :(ﾟωﾟﾉ+ &#39;_&#39;)[o^_^o -(ﾟΘﾟ)] ,ﾟДﾟﾉ:((ﾟｰﾟ==3) +&#39;_&#39;)[ﾟｰﾟ] }; (ﾟДﾟ) [ﾟΘﾟ] =((ﾟωﾟﾉ==3) +&#39;_&#39;) [c^_^o];(ﾟДﾟ) [&#39;c&#39;] = ((ﾟДﾟ)+&#39;_&#39;) [ (ﾟｰﾟ)+(ﾟｰﾟ)-(ﾟΘﾟ) ];(ﾟДﾟ) [&#39;o&#39;] = ((ﾟДﾟ)+&#39;_&#39;) [ﾟΘﾟ];(ﾟoﾟ)=(ﾟДﾟ) [&#39;c&#39;]+(ﾟДﾟ) [&#39;o&#39;]+(ﾟωﾟﾉ +&#39;_&#39;)[ﾟΘﾟ]+ ((ﾟωﾟﾉ==3) +&#39;_&#39;) [ﾟｰﾟ] + ((ﾟДﾟ) +&#39;_&#39;) [(ﾟｰﾟ)+(ﾟｰﾟ)]+ ((ﾟｰﾟ==3) +&#39;_&#39;) [ﾟΘﾟ]+((ﾟｰﾟ==3) +&#39;_&#39;) [(ﾟｰﾟ) - (ﾟΘﾟ)]+(ﾟДﾟ) [&#39;c&#39;]+((ﾟДﾟ)+&#39;_&#39;) [(ﾟｰﾟ)+(ﾟｰﾟ)]+ (ﾟДﾟ) [&#39;o&#39;]+((ﾟｰﾟ==3) +&#39;_&#39;) [ﾟΘﾟ];(ﾟДﾟ) [&#39;_&#39;] =(o^_^o) [ﾟoﾟ] [ﾟoﾟ];(ﾟεﾟ)=((ﾟｰﾟ==3) +&#39;_&#39;) [ﾟΘﾟ]+ (ﾟДﾟ) .ﾟДﾟﾉ+((ﾟДﾟ)+&#39;_&#39;) [(ﾟｰﾟ) + (ﾟｰﾟ)]+((ﾟｰﾟ==3) +&#39;_&#39;) [o^_^o -ﾟΘﾟ]+((ﾟｰﾟ==3) +&#39;_&#39;) [ﾟΘﾟ]+ (ﾟωﾟﾉ +&#39;_&#39;) [ﾟΘﾟ]; (ﾟｰﾟ)+=(ﾟΘﾟ); (ﾟДﾟ)[ﾟεﾟ]=&#39;\\&#39;; (ﾟДﾟ).ﾟΘﾟﾉ=(ﾟДﾟ+ ﾟｰﾟ)[o^_^o -(ﾟΘﾟ)];(oﾟｰﾟo)=(ﾟωﾟﾉ +&#39;_&#39;)[c^_^o];(ﾟДﾟ) [ﾟoﾟ]=&#39;\&quot;&#39;;(ﾟДﾟ) [&#39;_&#39;] ( (ﾟДﾟ) [&#39;_&#39;] (ﾟεﾟ+(ﾟДﾟ)[ﾟoﾟ]+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ (ﾟΘﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟｰﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((o^_^o) +(o^_^o))+ ((o^_^o) - (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((o^_^o) +(o^_^o))+ (ﾟｰﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+((ﾟｰﾟ) + (ﾟΘﾟ))+ (c^_^o)+ (ﾟДﾟ)[ﾟεﾟ]+((o^_^o) +(o^_^o))+ (ﾟΘﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟΘﾟ)+ (ﾟДﾟ)[ﾟoﾟ]) (ﾟΘﾟ)) (&#39;_&#39;);</code></p>
<p>对比一下这两段aaencode代码，你会发现两者的前面部分完全一样，变的只是后面的代码</p>
<p>前面一样的aaencode代码就是所谓的<strong>前置条件</strong>，无论对什么JavaScript代码进行aaencode混淆，混淆后的代码中，前面部分的前置条件都是相同的</p>
<p>原因是因为，想要用颜文字混淆JS代码，哪怕只是简单的一句<code>alert(1)</code>也是很难实现的</p>
<p>还记得JSFuck得到语句 <code>alert(1)</code> 的步骤吗？先通过索引的方法从 <code>&quot;false&quot;</code> 中取出 <code>&quot;a&quot;</code> 、 <code>&quot;l&quot;</code> 和 <code>&quot;e&quot;</code>；从 <code>&quot;true&quot;</code> 中取出 <code>&quot;r&quot;</code> 、 <code>&quot;t&quot;</code>；用某个方法得到  <code>&quot;1&quot;</code> 、 <code>&quot;(&quot;</code> 和 <code>&quot;)&quot;</code></p>
<p>有了字符串<code>&quot;alert(1)&quot;</code>还不够，还有将字符串转换为语句：<code>[][&quot;filter&quot;][&quot;constructor&quot;](&quot;alert(1)&quot;)()</code>，那么这时又得想办法得到<code>&quot;filter&quot;</code> 和 <code>&quot;constructor&quot;</code> 了...</p>
<p><strong>冗余是混淆的通病</strong>，JSFuck是，aaencode也不例外</p>
<p>用aaencode混淆的 <code>alert(1)</code>，需要经过提前的赋值，然后就是与JSFuck类似的操作：拼凑出字符串、字符串转语句、为了转语句需要额外的字符串...</p>
<p>可以将前置条件理解成JSFuck中的字符串转语句代码：<code>[][&quot;filter&quot;][&quot;constructor&quot;](&quot;你的代码&quot;)()</code>，正是因为字符串转语句的重要性，所以前置条件才会作为&quot;统一&quot;的前缀，出现在任意JS代码的混淆中</p>
<p>这也是为什么明明是空的JS代码，还能给你混淆出一大段aaencode代码的原因...</p>
<p>前置条件取决于具体的混淆方式，方式不同前置条件也不一样，如果自己写一个aaencode颜文字编码，那么前置条件就取决于你怎么编</p>
<blockquote>
<p>想深入追踪一下aaencode的编码过程，可以访问这篇<a href="https://blog.csdn.net/github_36788573/article/details/102866435" target="_blank" rel="noopener">博文</a></p>
</blockquote>
<blockquote>
<blockquote>
<p>【本部分参考】</p>
<p>TechBridge文章 <a href="https://blog.techbridge.cc/2016/07/16/javascript-jsfuck-and-aaencode/" target="_blank" rel="noopener">https://blog.techbridge.cc/2016/07/16/javascript-jsfuck-and-aaencode/</a></p>
<p>aaencode在线编码器 <a href="http://utf-8.jp/public/aaencode.html" target="_blank" rel="noopener">http://utf-8.jp/public/aaencode.html</a></p>
<p>CSDN yudhui文章 <a href="https://blog.csdn.net/github_36788573/article/details/102866435" target="_blank" rel="noopener">https://blog.csdn.net/github_36788573/article/details/102866435</a></p>
</blockquote>
</blockquote>
<hr>
<h3 id="jjencode"><a href="#jjencode" class="headerlink" title="jjencode"></a>jjencode</h3><p>jjencode同样又<code>长谷川阳介</code>先生创建，只是与JSFuck的创建时间不同</p>
<p>jjencode创建于2009年7月，JSFuck则是2010年底；jjencode先于JSFuck，而在混淆能力上，jjencode弱于JSFuck——jjencode将JS代码混淆为<strong><code>[]()!+,\&quot;$.:;_{}~=</code> 这18个字符的排列组合</strong></p>
<p>可以说jjencode是JSFuck的早期弱化版本</p>
<blockquote>
<p>Perl语言有ppencode混淆、Ruby语言有rrencode，所以从jjencode的命名也能看出这是最初的JS混淆</p>
</blockquote>
<p>详细解析jjencode的混淆方式可以查看<a href="https://eller.tech/post/33" target="_blank" rel="noopener">文章</a>，很棒的文章。我没那耐心慢慢看jjencode源码，也对JavaScript无感: )</p>
<h4 id="自定义"><a href="#自定义" class="headerlink" title="自定义"></a>自定义</h4><p>JSFuck混淆的灵活性很差，因为它是基本固定的，拿 <code>1</code> 举个例子，或许除了 <code>+!![]</code> 和 <code>+!+[]</code> 外，或许还能通过其它办法得到 <code>1</code> ，但终究是有限的，因为JSFuck困死在 <code>[]()!+</code> 这六个字符</p>
<p>JSFuck给你的发挥余地不多</p>
<p>但是jjencode不同，尽管它也困死在18个字符中，但它能够实现自定义jjencode</p>
<p>所谓&quot;自定义&quot;是指变量名自定义，而代码逻辑是一样的，混淆本身就追求的是&quot;看上去&quot;不一样</p>
<ul>
<li><p>全局变量gv（默认的jjencode全局变量为<code>$</code>）</p>
<p>空的JavaScript代码经过jjencode混淆为：</p>
<p><code>$=~[];$={___:++$,$$$$:(![]+&quot;&quot;)[$],__$:++$,$_$_:(![]+&quot;&quot;)[$],_$_:++$,$_$$:({}+&quot;&quot;)[$],$$_$:($[$]+&quot;&quot;)[$],_$$:++$,$$$_:(!&quot;&quot;+&quot;&quot;)[$],$__:++$,$_$:++$,$$__:({}+&quot;&quot;)[$],$$_:++$,$$$:++$,$___:++$,$__$:++$};$.$_=($.$_=$+&quot;&quot;)[$.$_$]+($._$=$.$_[$.__$])+($.$$=($.$+&quot;&quot;)[$.__$])+((!$)+&quot;&quot;)[$._$$]+($.__=$.$_[$.$$_])+($.$=(!&quot;&quot;+&quot;&quot;)[$.__$])+($._=(!&quot;&quot;+&quot;&quot;)[$._$_])+$.$_[$.$_$]+$.__+$._$+$.$;$.$$=$.$+(!&quot;&quot;+&quot;&quot;)[$._$$]+$.__+$._+$.$+$.$$;$.$=($.___)[$.$_][$.$_];$.$($.$($.$$+&quot;\&quot;&quot;+$.$_$_+(![]+&quot;&quot;)[$._$_]+$.$$$_+&quot;\\&quot;+$.__$+$.$$_+$._$_+$.__+&quot;(&quot;+$.__$+&quot;)&quot;+&quot;\&quot;&quot;)())();</code></p>
<p>这是之前提到的&quot;前置条件&quot;</p>
<p>我们来稍微解析一下这段jjencode代码。首先看第一条语句：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ = ~[];</span><br></pre></td></tr></table></figure>

<p>这里将变量 <code>$</code> 赋值为 <code>-1</code>：空数组<code>[]</code>在被当作数使用时，表示<code>0</code>；而<code>~</code>是按位取反操作，有<code>~0 = -1</code></p>
<p>然后是一个比较长的Hash表语句：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ = &#123;</span><br><span class="line">  	___ : ++$,</span><br><span class="line">      $$$$ : (![]+<span class="string">""</span>)[$],</span><br><span class="line">      __$ : ++$,</span><br><span class="line">      $_$_ : (![]+<span class="string">""</span>)[$],</span><br><span class="line">      _$_ : ++$,</span><br><span class="line">      $_$$ : (&#123;&#125;+<span class="string">""</span>)[$],</span><br><span class="line">      $$_$ : ($[$]+<span class="string">""</span>)[$],</span><br><span class="line">      _$$ : ++$,</span><br><span class="line">      $$$_ : (!<span class="string">""</span>+<span class="string">""</span>)[$],</span><br><span class="line">      $__ : ++$,</span><br><span class="line">      $_$ : ++$,</span><br><span class="line">      $$__ : (&#123;&#125;+<span class="string">""</span>)[$],</span><br><span class="line">      $$_ : ++$,</span><br><span class="line">      $$$ : ++$,</span><br><span class="line">      $___ : ++$,</span><br><span class="line">      $__$ : ++$</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<p>这段代码通过已有的 <code>$ = -1</code> ，直接设置了16个新变量：<code>___</code>、<code>$$$$</code>、<code>__$</code>、<code>$_$_</code>、<code>_$_</code>、<code>$_$$</code>、<code>$$_$</code>、<code>_$$</code>、<code>$$$_</code>、<code>$__</code>、<code>$_$</code>、<code>$$__</code>、<code>$$_</code>、<code>$$$</code>、<code>$___</code>、<code>$__$</code></p>
<p>在浏览器中运行下这段代码，查看这些变量分别被赋予了什么值：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">___ : <span class="number">0</span></span><br><span class="line">  $$$$ : <span class="string">"f"</span></span><br><span class="line">  __$ : <span class="number">1</span></span><br><span class="line">  $_$_ : <span class="string">"a"</span></span><br><span class="line">  _$_ : <span class="number">2</span></span><br><span class="line">  $_$$ : <span class="string">"b"</span></span><br><span class="line">  $$_$ : <span class="string">"d"</span></span><br><span class="line">  _$$ : <span class="number">3</span></span><br><span class="line">  $$$_ : <span class="string">"e"</span></span><br><span class="line">  $__ : <span class="number">4</span></span><br><span class="line">  $_$ : <span class="number">5</span></span><br><span class="line">  $$__ : <span class="string">"c"</span></span><br><span class="line">  $$_ : <span class="number">6</span></span><br><span class="line">  $$$ : <span class="number">7</span></span><br><span class="line">  $___ : <span class="number">8</span></span><br><span class="line">  $__$ : <span class="number">9</span></span><br></pre></td></tr></table></figure>

<p><code>$</code> 之所以在jjencode中被称为<strong>全局变量</strong>，就是因为所有变量以及后续操作都源于最初的<code>$ = ~[];</code></p>
<p>如果把全局变量改成<code>帅</code>，就有：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">帅 = ~[];</span><br><span class="line">  帅 = &#123;</span><br><span class="line">      ___ : ++帅,</span><br><span class="line">      $$$$ : (![]+<span class="string">""</span>)[帅],</span><br><span class="line">      __$ : ++帅,</span><br><span class="line">      $_$_ : (![]+<span class="string">""</span>)[帅],</span><br><span class="line">      _$_ : ++帅,</span><br><span class="line">      $_$$ : (&#123;&#125;+<span class="string">""</span>)[帅],</span><br><span class="line">      $$_$ : (帅[帅]+<span class="string">""</span>)[帅],</span><br><span class="line">      _$$ : ++帅,</span><br><span class="line">      $$$_ : (!<span class="string">""</span>+<span class="string">""</span>)[帅],</span><br><span class="line">      $__ : ++帅,</span><br><span class="line">      $_$ : ++帅,</span><br><span class="line">      $$__ : (&#123;&#125;+<span class="string">""</span>)[帅],</span><br><span class="line">      $$_ : ++帅,</span><br><span class="line">      $$$ : ++帅,</span><br><span class="line">      $___ : ++帅,</span><br><span class="line">      $__$ : ++帅</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>内置的16个初始变量</p>
<p>你留意到了吗？</p>
<p>第二条长长的Hash表语句中定义的16个变量也是可以更改的，把这16个变量改成你喜欢的变量名，并且在源代码的其它对应地方也进行更改，那么你就能够实现<strong>自定义的jjencode</strong></p>
</li>
</ul>
<p>比如，语句 <code>alert(1);</code> 在 <code>http://utf-8.jp/public/jjencode.html</code> 上的默认混淆是：</p>
<p><code>$=~[];$={___:++$,$$$$:(![]+&quot;&quot;)[$],__$:++$,$_$_:(![]+&quot;&quot;)[$],_$_:++$,$_$$:({}+&quot;&quot;)[$],$$_$:($[$]+&quot;&quot;)[$],_$$:++$,$$$_:(!&quot;&quot;+&quot;&quot;)[$],$__:++$,$_$:++$,$$__:({}+&quot;&quot;)[$],$$_:++$,$$$:++$,$___:++$,$__$:++$};$.$_=($.$_=$+&quot;&quot;)[$.$_$]+($._$=$.$_[$.__$])+($.$$=($.$+&quot;&quot;)[$.__$])+((!$)+&quot;&quot;)[$._$$]+($.__=$.$_[$.$$_])+($.$=(!&quot;&quot;+&quot;&quot;)[$.__$])+($._=(!&quot;&quot;+&quot;&quot;)[$._$_])+$.$_[$.$_$]+$.__+$._$+$.$;$.$$=$.$+(!&quot;&quot;+&quot;&quot;)[$._$$]+$.__+$._+$.$+$.$$;$.$=($.___)[$.$_][$.$_];$.$($.$($.$$+&quot;\&quot;&quot;+$.$_$_+(![]+&quot;&quot;)[$._$_]+$.$$$_+&quot;\\&quot;+$.__$+$.$$_+$._$_+$.__+&quot;(&quot;+$.__$+&quot;);&quot;+&quot;\&quot;&quot;)())();</code></p>
<p>将全局变量从 <code>$</code> 替换成 <code>风伯</code>，然后修改jjencode源码，依次替换掉16个变量名为：<code>盘古</code>、<code>女娲</code>、<code>伏羲</code>、<code>精卫</code>、<code>夸父</code>、<code>蚩尤</code>、<code>黄帝</code>、<code>炎帝</code>、<code>刑天</code>、<code>共工</code>、<code>祝融</code>、<code>大禹</code>、<code>后羿</code>、<code>嫦娥</code>、<code>东皇太一</code>、<code>女魃</code></p>
<p>再利用这段修改过后的jjencode对 <code>alert(1)</code> 进行编码，得到</p>
<p><code>风伯=~[];风伯={盘古:++风伯,女魃:(![]+&quot;&quot;)[风伯],女娲:++风伯,祝融:(![]+&quot;&quot;)[风伯],伏羲:++风伯,大禹:({}+&quot;&quot;)[风伯],嫦娥:(风伯[风伯]+&quot;&quot;)[风伯],精卫:++风伯,东皇太一:(!&quot;&quot;+&quot;&quot;)[风伯],夸父:++风伯,蚩尤:++风伯,后羿:({}+&quot;&quot;)[风伯],黄帝:++风伯,炎帝:++风伯,刑天:++风伯,共工:++风伯};风伯.$_=(风伯.$_=风伯+&quot;&quot;)[风伯.蚩尤]+(风伯._$=风伯.$_[风伯.女娲])+(风伯.$$=(风伯.$+&quot;&quot;)[风伯.女娲])+((!风伯)+&quot;&quot;)[风伯.精卫]+(风伯.__=风伯.$_[风伯.黄帝])+(风伯.$=(!&quot;&quot;+&quot;&quot;)[风伯.女娲])+(风伯._=(!&quot;&quot;+&quot;&quot;)[风伯.伏羲])+风伯.$_[风伯.蚩尤]+风伯.__+风伯._$+风伯.$;风伯.$$=风伯.$+(!&quot;&quot;+&quot;&quot;)[风伯.精卫]+风伯.__+风伯._+风伯.$+风伯.$$;风伯.$=(风伯.盘古)[风伯.$_][风伯.$_];风伯.$(风伯.$(风伯.$$+&quot;\&quot;&quot;+风伯.祝融+(![]+&quot;&quot;)[风伯.伏羲]+风伯.东皇太一+&quot;\\&quot;+风伯.女娲+风伯.黄帝+风伯.伏羲+风伯.__+&quot;(&quot;+风伯.女娲+&quot;)&quot;+&quot;\&quot;&quot;)())();</code></p>
<p>（还能继续改，因为还有一些变量如 <code>$_</code>、<code>$</code>、<code>__</code> 都未更改）</p>
<p>把上面这段代码复制到浏览器的Console中执行，是会有消息框出现显示&quot;1&quot;，也就是意味着执行了语句 <code>alert(1)</code></p>
<p>碰巧最近热议着&quot;完全自主开发的&quot;木兰编程语言，我觉得我上我也行，看我上面的代码，拿去唬人不成问题</p>
<blockquote>
<blockquote>
<p>【本部分参考】</p>
<p>Eller博客文章 <a href="https://eller.tech/post/33" target="_blank" rel="noopener">https://eller.tech/post/33</a></p>
<p>JSFuck Wiki <a href="https://zh.wikipedia.org/zh-hans/JSFuck" target="_blank" rel="noopener">https://zh.wikipedia.org/zh-hans/JSFuck</a></p>
</blockquote>
</blockquote>
<hr>
<h2 id="Decode"><a href="#Decode" class="headerlink" title="Decode"></a>Decode</h2><ul>
<li><p><code>.toString()</code></p>
<p>事实上许多JS混淆的基本思路都与JSFuck一样，即<code>[][&#39;filter&#39;][&#39;constructor&#39;][你的代码]()</code></p>
<p>注意到最后面的 <code>()</code> ，它表示<strong>调用函数</strong>，那么将它替换为 <code>.toString()</code>，就能阻止前面函数的执行、并且把函数转换成字符串输出出来</p>
<p>就目前介绍到的3中混淆方式而言，JSFuck和jjencode都能通过置换最后的 <code>()</code> 为 <code>.toString()</code>，还原JS代码；而aaencode不行，它本身最后面就不是以 <code>()</code> 结尾</p>
<blockquote>
<p>举例</p>
<p>将 <code>alert(1);</code> 进行JSFuck加密后，把密文放在浏览器的Console中，将最后的 <code>()</code> 替换为 <code>.toString()</code>，执行</p>
<p>结果会输出</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="string">"function anonymous(</span></span><br><span class="line"><span class="string">&gt;) &#123;</span></span><br><span class="line"><span class="string">&gt;alert(1);</span></span><br><span class="line"><span class="string">&gt;&#125;"</span></span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p><strong>hook function constructor</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Function</span>.prototype.__defineGetter__(<span class="string">'constructor'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">'code:'</span>, ...args);</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">Function</span>(...args);</span><br><span class="line">	&#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这个方法直接修改了深层的JS功能，需要对JS有较深入的了解</p>
<p>原本函数调用只是单纯地调用该函数，但是修改后的JS能够在执行该函数的同时，把函数的执行语句通过 <code>console.log()</code> 输出出来</p>
<p>使用方法就是复制上面的代码，在浏览器的Console中执行，随后就可以执行一些JS混淆代码</p>
<p>以无法通过 <code>.toString()</code> 还原的aaencode为例，当浏览器的Console执行上面的代码后，再执行以下aaencode代码：</p>
<p><code>ﾟωﾟﾉ= /｀ｍ´）ﾉ ~┻━┻   //*´∇｀*/ [&#39;_&#39;]; o=(ﾟｰﾟ)  =_=3; c=(ﾟΘﾟ) =(ﾟｰﾟ)-(ﾟｰﾟ); (ﾟДﾟ) =(ﾟΘﾟ)= (o^_^o)/ (o^_^o);(ﾟДﾟ)={ﾟΘﾟ: &#39;_&#39; ,ﾟωﾟﾉ : ((ﾟωﾟﾉ==3) +&#39;_&#39;) [ﾟΘﾟ] ,ﾟｰﾟﾉ :(ﾟωﾟﾉ+ &#39;_&#39;)[o^_^o -(ﾟΘﾟ)] ,ﾟДﾟﾉ:((ﾟｰﾟ==3) +&#39;_&#39;)[ﾟｰﾟ] }; (ﾟДﾟ) [ﾟΘﾟ] =((ﾟωﾟﾉ==3) +&#39;_&#39;) [c^_^o];(ﾟДﾟ) [&#39;c&#39;] = ((ﾟДﾟ)+&#39;_&#39;) [ (ﾟｰﾟ)+(ﾟｰﾟ)-(ﾟΘﾟ) ];(ﾟДﾟ) [&#39;o&#39;] = ((ﾟДﾟ)+&#39;_&#39;) [ﾟΘﾟ];(ﾟoﾟ)=(ﾟДﾟ) [&#39;c&#39;]+(ﾟДﾟ) [&#39;o&#39;]+(ﾟωﾟﾉ +&#39;_&#39;)[ﾟΘﾟ]+ ((ﾟωﾟﾉ==3) +&#39;_&#39;) [ﾟｰﾟ] + ((ﾟДﾟ) +&#39;_&#39;) [(ﾟｰﾟ)+(ﾟｰﾟ)]+ ((ﾟｰﾟ==3) +&#39;_&#39;) [ﾟΘﾟ]+((ﾟｰﾟ==3) +&#39;_&#39;) [(ﾟｰﾟ) - (ﾟΘﾟ)]+(ﾟДﾟ) [&#39;c&#39;]+((ﾟДﾟ)+&#39;_&#39;) [(ﾟｰﾟ)+(ﾟｰﾟ)]+ (ﾟДﾟ) [&#39;o&#39;]+((ﾟｰﾟ==3) +&#39;_&#39;) [ﾟΘﾟ];(ﾟДﾟ) [&#39;_&#39;] =(o^_^o) [ﾟoﾟ] [ﾟoﾟ];(ﾟεﾟ)=((ﾟｰﾟ==3) +&#39;_&#39;) [ﾟΘﾟ]+ (ﾟДﾟ) .ﾟДﾟﾉ+((ﾟДﾟ)+&#39;_&#39;) [(ﾟｰﾟ) + (ﾟｰﾟ)]+((ﾟｰﾟ==3) +&#39;_&#39;) [o^_^o -ﾟΘﾟ]+((ﾟｰﾟ==3) +&#39;_&#39;) [ﾟΘﾟ]+ (ﾟωﾟﾉ +&#39;_&#39;) [ﾟΘﾟ]; (ﾟｰﾟ)+=(ﾟΘﾟ); (ﾟДﾟ)[ﾟεﾟ]=&#39;\\&#39;; (ﾟДﾟ).ﾟΘﾟﾉ=(ﾟДﾟ+ ﾟｰﾟ)[o^_^o -(ﾟΘﾟ)];(oﾟｰﾟo)=(ﾟωﾟﾉ +&#39;_&#39;)[c^_^o];(ﾟДﾟ) [ﾟoﾟ]=&#39;\&quot;&#39;;(ﾟДﾟ) [&#39;_&#39;] ( (ﾟДﾟ) [&#39;_&#39;] (ﾟεﾟ+(ﾟДﾟ)[ﾟoﾟ]+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ (ﾟΘﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟｰﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((o^_^o) +(o^_^o))+ ((o^_^o) - (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((o^_^o) +(o^_^o))+ (ﾟｰﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+((ﾟｰﾟ) + (ﾟΘﾟ))+ (c^_^o)+ (ﾟДﾟ)[ﾟεﾟ]+((o^_^o) +(o^_^o))+ (ﾟΘﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟΘﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+((ﾟｰﾟ) + (o^_^o))+ (o^_^o)+ (ﾟДﾟ)[ﾟoﾟ]) (ﾟΘﾟ)) (&#39;_&#39;);</code></p>
<p>除了弹出消息框显示&quot;1&quot;外，还会在Console中出现语句：<code>code: alert(1);</code></p>
</li>
<li><p>在线帮助</p>
<p>大部分JS混淆都已经广为人知，有许多人找寻对应的decode方法，比如：</p>
<ul>
<li>JSFuck对应的JsUnFuck：<a href="http://codertab.com/JsUnFuck" target="_blank" rel="noopener">http://codertab.com/JsUnFuck</a></li>
</ul>
<p>考验你的信息检索能力了</p>
</li>
<li><p>手工计算</p>
<p>手工将JS混淆还原的确是可行的，权当在练习JavaScript的<strong>类型转换</strong></p>
<p>网络上还有人承接此类工作呢：</p>
<img src="/images/js_misunderstand/jjencode_by_person.jpg" style="zoom: 67%;" />

</li>
</ul>
<hr>
<h2 id="混淆的意义"><a href="#混淆的意义" class="headerlink" title="混淆的意义"></a>混淆的意义</h2><ul>
<li><p>正面的</p>
<p>这篇文章只是在某道CTF题目之后延申出来学习用的，就我而言混淆JS代码能给解CTF题目的人增添一些困惑</p>
<p>除此之外似乎没有什么用了，just interesting</p>
</li>
<li><p>负面的</p>
<ul>
<li><p>代码量增多</p>
</li>
<li><p>非加密</p>
<p>混淆不是加密，完全可以在仅知道混淆后代码的情况下，还原出原代码</p>
</li>
<li><p>有可能失效</p>
<p>经过混淆后的JS代码有可能无法使用，这样的原因有以下几种：</p>
<ol>
<li>JS代码不规范，<code>if</code>、<code>for</code> 语句没有 <code>{}</code>；代码没有以 <code>;</code> 结束等</li>
<li>JS代码中有大量复杂的正则表达式</li>
</ol>
</li>
</ul>
</li>
</ul>
<p>因此往往建议对JS代码进行加密后再混淆，效果倍增，别人根本看不懂</p>
<hr>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li><p><strong>JSFuck</strong>：仅由 <code>[]()+!</code> 六个字符组成</p>
</li>
<li><p><strong>aaencode</strong>：颜文字编码</p>
</li>
<li><p><strong>jjencode</strong>：由<code>[]()!+,\&quot;$.:;_{}~=</code> 18个字符组成，自定义能力强</p>
<p>明显特征为开头的 <code>全局变量=~[];</code>，默认的全局变量为 <code>$</code></p>
</li>
</ul>
<p>解码方法：<code>.toString()</code>；<strong>hook function constructor</strong>；在线网站解码</p>
<hr>
<p>end</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/CTF/" rel="tag"># CTF</a>
              <a href="/tags/MISC/" rel="tag"># MISC</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/2020/02/12/jpg%E5%9B%BE%E7%A7%8D/" rel="next" title="jpg图种">
                  <i class="fa fa-chevron-left"></i> jpg图种
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/2020/02/12/LSB%E9%9A%90%E5%86%99/" rel="prev" title="LSB隐写">
                  LSB隐写 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#JS代码混淆"><span class="nav-number">1.</span> <span class="nav-text">JS代码混淆</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#混淆方式"><span class="nav-number">1.1.</span> <span class="nav-text">混淆方式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JSFuck-JSF-ck"><span class="nav-number">1.1.1.</span> <span class="nav-text">JSFuck (JSF*ck)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#aaencode"><span class="nav-number">1.1.2.</span> <span class="nav-text">aaencode</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#前置条件"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">前置条件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#jjencode"><span class="nav-number">1.1.3.</span> <span class="nav-text">jjencode</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#自定义"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">自定义</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Decode"><span class="nav-number">1.2.</span> <span class="nav-text">Decode</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#混淆的意义"><span class="nav-number">1.3.</span> <span class="nav-text">混淆的意义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">1.4.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="examine"
    src="/images/none.ico">
  <p class="site-author-name" itemprop="name">examine</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/examine2" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;examine2" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">examine</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="Symbols count total">40k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">1:07</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.0.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.4.2
  </div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.2"></script><script src="/js/motion.js?v=7.4.2"></script>
<script src="/js/schemes/pisces.js?v=7.4.2"></script>
<script src="/js/next-boot.js?v=7.4.2"></script>



  


















  

  
      
<script type="text/x-mathjax-config">

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script>
<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', () => {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

    

  

  

</body>
</html>
